
â•­â”€â”€â”€ Claude Code v2.0.76 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                    â”‚ Tips for getting        â”‚
â”‚                 Welcome back Ethon!                â”‚ started                 â”‚
â”‚                                                    â”‚ Ask Claude to create aâ€¦ â”‚
â”‚                     * â–â–›â–ˆâ–ˆâ–ˆâ–œâ–Œ *                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                    * â–â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›â–˜ *                   â”‚ Recent activity         â”‚
â”‚                     *  â–˜â–˜ â–â–  *                    â”‚ No recent activity      â”‚
â”‚                                                    â”‚                         â”‚
â”‚   Opus 4.5 Â· Claude API Â· waming313@gmail.com's    â”‚                         â”‚
â”‚   Organization                                     â”‚                         â”‚
â”‚      D:\software\develop_tools\git\gitee\jcp       â”‚                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

> æˆ‘å•é¡Œæ˜¯é—œæ–¼Javaçš„ä¸€å€‹å•é¡Œï¼šä½ çŸ¥é“jcpå’Œjsrå—ï¼Ÿå¯ä»¥å…ˆç°¡çŸ­çš„å›ç­”æˆ‘ï¼Œæˆ‘å¾ŒçºŒæœƒ
å†å•ä½ æ›´è©³ç´°çš„å•é¡Œ; 

â— æ˜¯çš„ï¼Œæˆ‘çŸ¥é“é€™å…©å€‹æ¦‚å¿µï¼š

  JCP (Java Community Process)
  - Java ç¤¾ç¾¤æµç¨‹ï¼Œæ˜¯ä¸€å€‹é–‹æ”¾çš„åœ‹éš›çµ„ç¹”
  - è² è²¬ Java æŠ€è¡“è¦ç¯„çš„åˆ¶å®šã€å¯©æ ¸å’Œä¿®è¨‚
  - æˆå“¡åŒ…æ‹¬ä¼æ¥­ã€çµ„ç¹”å’Œå€‹äººé–‹ç™¼è€…

  JSR (Java Specification Request)
  - Java è¦ç¯„è«‹æ±‚ï¼Œæ˜¯ JCP ä¸­æå‡ºæ–°è¦ç¯„æˆ–ä¿®æ”¹ç¾æœ‰è¦ç¯„çš„æ­£å¼ææ¡ˆ
  - æ¯å€‹ JSR éƒ½æœ‰ç·¨è™Ÿï¼Œä¾‹å¦‚ï¼š
    - JSR 335ï¼šLambda è¡¨é”å¼ (Java 8)
    - JSR 380ï¼šBean Validation 2.0
    - JSR 330ï¼šDependency Injection

  ç°¡å–®ä¾†èªªï¼šJCP æ˜¯æµç¨‹/çµ„ç¹”ï¼ŒJSR æ˜¯å…·é«”çš„è¦ç¯„ææ¡ˆã€‚

  è«‹ç¹¼çºŒå•ä½ çš„è©³ç´°å•é¡Œã€‚

> æˆ‘å¯ä»¥ç†è§£jsræ˜¯javaè£é¢çš„äº¤é€šè¦å‰‡å—ï¼Ÿè€Œjcpæ˜¯javaè£é¢çš„jsrçš„è¦å‰‡åˆ¶å®šè€…ã€‚å¯
ä»¥é€™æ¨£ç†è§£å—ï¼Ÿ 

â— é€™å€‹æ¯”å–»å¤§è‡´æ­£ç¢ºï¼Œä½†å¯ä»¥å†ç²¾ç¢ºä¸€é»ï¼š

  JSR = äº¤é€šè¦å‰‡ âœ“
  - å®šç¾©äº† Java æŸå€‹åŠŸèƒ½ã€Œæ‡‰è©²æ€éº¼åšã€çš„æ¨™æº–è¦ç¯„
  - ä¾‹å¦‚ï¼šJDBC è¦ç¯„å®šç¾©äº† Java å¦‚ä½•é€£æ¥è³‡æ–™åº«

  JCP = åˆ¶å®šè¦å‰‡çš„ã€Œæµç¨‹/æ©Ÿåˆ¶ã€
  - æ›´åƒæ˜¯ã€Œç«‹æ³•ç¨‹åºã€ï¼Œè€Œä¸åƒ…æ˜¯ã€Œç«‹æ³•è€…ã€
  - çœŸæ­£çš„åˆ¶å®šè€…æ˜¯åƒèˆ‡ JCP çš„æˆå“¡ï¼ˆOracleã€IBMã€Red Hatã€å€‹äººé–‹ç™¼è€…ç­‰ï¼‰

  è£œå……ä¸€å€‹æ¦‚å¿µæœƒæ›´å®Œæ•´ï¼š

  RI (Reference Implementation) = åƒè€ƒå¯¦ä½œ
  - è¦ç¯„çš„å®˜æ–¹ç¤ºç¯„å¯¦ä½œ
  - è­‰æ˜é€™å€‹è¦ç¯„æ˜¯å¯è¡Œçš„

  TCK (Technology Compatibility Kit) = ç›¸å®¹æ€§æ¸¬è©¦å¥—ä»¶
  - ç”¨ä¾†é©—è­‰å…¶ä»–å¯¦ä½œæ˜¯å¦ç¬¦åˆè¦ç¯„

  æ‰€ä»¥å®Œæ•´çš„æ¯”å–»ï¼š
  - JCP = ç«‹æ³•ç¨‹åº
  - JSR = æ³•å¾‹æ¢æ–‡
  - RI = å®˜æ–¹ç¤ºç¯„æ¡ˆä¾‹
  - TCK = åŸ·æ³•æª¢é©—æ¨™æº–

  ä½ çš„ç†è§£æ–¹å‘æ˜¯å°çš„ï¼

> ä½ å¯ä»¥å¹«æˆ‘åˆ†é¡ä¸€ä¸‹jsrå—ï¼Ÿ 

â— å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯å¸¸è¦‹çš„ JSR åˆ†é¡æ–¹å¼ï¼š

  æŒ‰ Java å¹³å°åˆ†é¡

  | å¹³å°                 | èªªæ˜   | å¸¸è¦‹ JSR                                   |
  |----------------------|--------|--------------------------------------------|
  | Java SE              | æ¨™æº–ç‰ˆ | JSR 335 (Lambda)ã€JSR 310 (Date/Time API)  |
  | Java EE / Jakarta EE | ä¼æ¥­ç‰ˆ | JSR 366 (Java EE 8)ã€JSR 340 (Servlet 3.1) |
  | Java ME              | å¾®å‹ç‰ˆ | JSR 271 (MIDP 3.0)                         |

  æŒ‰åŠŸèƒ½é ˜åŸŸåˆ†é¡

  èªè¨€ç‰¹æ€§
  - JSR 335ï¼šLambda è¡¨é”å¼
  - JSR 269ï¼šAnnotation Processing

  Web æŠ€è¡“
  - JSR 340ï¼šServlet
  - JSR 344ï¼šJSF (JavaServer Faces)
  - JSR 370ï¼šJAX-RS (RESTful Web Services)

  è³‡æ–™æŒä¹…åŒ–
  - JSR 338ï¼šJPA (Java Persistence API)
  - JSR 221ï¼šJDBC 4.0

  ä¾è³´æ³¨å…¥ / IoC
  - JSR 330ï¼šDependency Injection
  - JSR 299ï¼šCDI (Contexts and Dependency Injection)

  é©—è­‰
  - JSR 380ï¼šBean Validation 2.0

  JSON è™•ç†
  - JSR 353ï¼šJSON Processing
  - JSR 367ï¼šJSON Binding

  ä¸¦ç™¼ / å¤šåŸ·è¡Œç·’
  - JSR 236ï¼šConcurrency Utilities for Java EE

  æŒ‰ç‹€æ…‹åˆ†é¡

  | ç‹€æ…‹        | èªªæ˜      |
  |-------------|-----------|
  | Draft       | è‰æ¡ˆéšæ®µ  |
  | Final       | æœ€çµ‚ç™¼å¸ƒ  |
  | Maintenance | ç¶­è­·ä¸­    |
  | Withdrawn   | å·²æ’¤å›    |
  | Dormant     | ä¼‘çœ /åœæ»¯ |

  ---
  ä½ æƒ³æ·±å…¥äº†è§£å“ªå€‹åˆ†é¡æˆ–ç‰¹å®šçš„ JSRï¼Ÿ

> æˆ‘å…ˆç­è§£æŒ‰å¹³è‡ºåˆ†é¡çš„jsrå§ï¼Œå°±æ˜¯å®ƒçš„åˆ†é¡èƒŒæ™¯æ˜¯å•¥ï¼Ÿè¬›è¿°ä¸€å€‹å®è§€æ¶æ§‹ï¼Œè¦æ±‚ç°¡
æ½”ï¼Œç°¡çŸ­ï¼Œæ ¸å¿ƒï¼› 

â— Java å¹³å°åˆ†é¡çš„å®è§€æ¶æ§‹

  æ ¸å¿ƒé‚è¼¯ï¼šä¸€å¥—èªè¨€ï¼Œä¸‰ç¨®å ´æ™¯

          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Java EE   â”‚  â† ä¼æ¥­ç´šæ“´å±•ï¼ˆWebã€åˆ†å¸ƒå¼ã€äº‹å‹™ï¼‰
          â”‚  (æ“´å±•å±¤)    â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚   Java SE   â”‚  â† æ ¸å¿ƒåŸºç¤ï¼ˆèªæ³•ã€JVMã€æ¨™æº–APIï¼‰
          â”‚  (åŸºç¤å±¤)    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ ç²¾ç°¡
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Java ME   â”‚  â† åµŒå…¥å¼/è³‡æºå—é™è¨­å‚™
          â”‚  (ç²¾ç°¡å±¤)    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ä¸‰è€…é—œä¿‚
  - Java SEï¼šåœ°åŸºï¼Œæ‰€æœ‰å¹³å°çš„åŸºç¤
  - Java EEï¼šSE + ä¼æ¥­ç´šå…ƒä»¶ï¼ˆç¾å·²ç§»äº¤çµ¦ Eclipse åŸºé‡‘æœƒï¼Œæ”¹å Jakarta EEï¼‰
  - Java MEï¼šSE çš„ç²¾ç°¡å­é›†ï¼ˆå·²é€æ¼¸å¼å¾®ï¼Œè¢« Android ç­‰å–ä»£ï¼‰

  åˆ†é¡èƒŒæ™¯
  - 1990s æœ«ï¼šJava ç«çˆ† â†’ ä¸åŒå ´æ™¯éœ€æ±‚åˆ†åŒ–
  - Sun æ±ºå®šï¼šä¸€å¥—èªè¨€æ ¸å¿ƒ + é‡å°å ´æ™¯çš„ä¸åŒ API çµ„åˆ

  ä¸€å¥è©±ç¸½çµï¼šSE æ˜¯å¿ƒè‡Ÿï¼ŒEE å¾€ä¸Šé•·ï¼ŒME å¾€ä¸‹ç¸®ã€‚

> é‚„æœ‰ä¸€å€‹å•é¡Œï¼ŒJavaçš„æ ¸å¿ƒä¸»é«”æ˜¯åŸºæ–¼Httpçš„å—ï¼Ÿ 

â— ä¸æ˜¯ã€‚

  Java æ ¸å¿ƒèˆ‡ HTTP çš„é—œä¿‚

  Java æ ¸å¿ƒ (Java SE)
  â”œâ”€â”€ JVMï¼ˆè™›æ“¬æ©Ÿï¼‰
  â”œâ”€â”€ èªè¨€è¦ç¯„ï¼ˆèªæ³•ã€é¡å‹ï¼‰
  â”œâ”€â”€ æ ¸å¿ƒ API
  â”‚   â”œâ”€â”€ é›†åˆ (Collection)
  â”‚   â”œâ”€â”€ IO / NIO
  â”‚   â”œâ”€â”€ å¤šåŸ·è¡Œç·’
  â”‚   â”œâ”€â”€ ç¶²è·¯ï¼ˆSocketã€TCP/UDPï¼‰  â† HTTP åªæ˜¯å…¶ä¸­ä¸€ç¨®æ‡‰ç”¨
  â”‚   â””â”€â”€ ...

  HTTP çš„ä½ç½®
  - HTTP æ˜¯æ‡‰ç”¨å±¤å”è­°ï¼Œå»ºç«‹åœ¨ TCP ä¹‹ä¸Š
  - Java SE æä¾›åº•å±¤ç¶²è·¯èƒ½åŠ›ï¼ˆSocketï¼‰
  - Java EE æ‰å¤§é‡åœç¹ HTTP å±•é–‹ï¼ˆServletã€JAX-RSï¼‰

  ç‚ºä»€éº¼æœƒæœ‰é€™ç¨®éŒ¯è¦ºï¼Ÿ
  - Java åœ¨ä¼æ¥­ç´šæ‡‰ç”¨ä¸­æœ€å¸¸è¦‹çš„å ´æ™¯æ˜¯ Web å¾Œç«¯
  - Web = HTTP
  - æ‰€ä»¥ã€ŒJava â‰ˆ HTTPã€çš„å°è±¡å¾ˆæ·±

  å¯¦éš›ä¸Š Java å¯ä»¥åš
  - æ¡Œé¢æ‡‰ç”¨ï¼ˆSwingã€JavaFXï¼‰
  - å¤§æ•¸æ“šè™•ç†ï¼ˆHadoopã€Sparkï¼‰
  - Android æ‡‰ç”¨
  - åµŒå…¥å¼ç³»çµ±
  - ç´” TCP/UDP æœå‹™

  ä¸€å¥è©±ï¼šJava æ˜¯é€šç”¨èªè¨€ï¼ŒHTTP åªæ˜¯å®ƒèƒ½è™•ç†çš„çœ¾å¤šå”è­°ä¹‹ä¸€ï¼Œä¸æ˜¯æ ¸å¿ƒã€‚

> æˆ‘çŸ¥é“äº†ï¼Œå› çˆ²æˆ‘å¹³æ™‚çš„å·¥ä½œæ˜¯Webé–‹ç™¼ï¼Œæˆ‘çš„ç†è§£ç‹¹éš˜äº†ï¼›

ä½†æ˜¯ä½ å¯ä»¥è¬›è¬›javaåŸºæ–¼Httpç›¸é—œçš„å—ï¼Ÿå…ˆè¬›ä¸€å€‹ç¸½é«”æ¶æ§‹ï¼Œè¦æ±‚æº–ç¢ºï¼Œæ ¸å¿ƒï¼Œç°¡æ½”ï¼›
 

â— Java HTTP æŠ€è¡“æ£§ç¸½é«”æ¶æ§‹

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  æ‡‰ç”¨å±¤æ¡†æ¶                       â”‚
  â”‚  Spring MVC / Spring Boot / JAX-RS / JSF        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                 Servlet è¦ç¯„                     â”‚  â† æ ¸å¿ƒæŠ½è±¡å±¤
  â”‚          (JSR 340: Servlet API)                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                Servlet å®¹å™¨                      â”‚
  â”‚         Tomcat / Jetty / Undertow               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                  Java SE                         â”‚
  â”‚          Socket / TCP / HTTP Client             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  æ ¸å¿ƒè¦é»

  Servlet æ˜¯é—œéµ
  - Java è™•ç† HTTP çš„æ¨™æº–è¦ç¯„
  - å®šç¾©äº† HttpServletRequestã€HttpServletResponse
  - æ‰€æœ‰ä¸»æµæ¡†æ¶ï¼ˆSpring MVC ç­‰ï¼‰åº•å±¤éƒ½åŸºæ–¼å®ƒ

  ä¸‰å±¤ç†è§£

  | å±¤æ¬¡ | è§’è‰²                   | ä»£è¡¨               |
  |------|------------------------|--------------------|
  | è¦ç¯„ | å®šç¾©æ¨™æº–               | Servlet API (JSR)  |
  | å®¹å™¨ | å¯¦ç¾è¦ç¯„ã€ç®¡ç†ç”Ÿå‘½é€±æœŸ | Tomcatã€Jetty      |
  | æ¡†æ¶ | ç°¡åŒ–é–‹ç™¼               | Spring MVCã€JAX-RS |

  ä¸€å¥è©±ç¸½çµï¼š

  Servlet è¦ç¯„æ˜¯ Java HTTP çš„å¿ƒè‡Ÿï¼Œå®¹å™¨æ˜¯å¼•æ“ï¼Œæ¡†æ¶æ˜¯æ–¹å‘ç›¤ã€‚

  è¦æ·±å…¥å“ªä¸€å±¤ï¼Ÿ

> è¬›è¬›servletå®¹å™¨é€™å¡Šå§ï¼Œå…ˆè¬›æ ¸å¿ƒæ¶æ§‹ï¼Œè¦æ±‚æ ¸å¿ƒï¼Œç°¡æ½”ï¼Œæº–ç¢º 

â— Servlet å®¹å™¨æ ¸å¿ƒæ¶æ§‹

            HTTP è«‹æ±‚
                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚          Connector              â”‚  â† ç¶²è·¯å±¤ï¼šç›£è½ç«¯å£ã€è§£æ HTTP
  â”‚     (æ¥æ”¶è«‹æ±‚ã€è¿”å›éŸ¿æ‡‰)          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚          Container              â”‚  â† å®¹å™¨å±¤ï¼šç®¡ç† Servlet
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Engine (å¼•æ“)              â”‚  â”‚  â† é ‚å±¤å®¹å™¨
  â”‚  â”‚  â””â”€ Host (è™›æ“¬ä¸»æ©Ÿ)        â”‚  â”‚  â† åŸŸåå°æ‡‰
  â”‚  â”‚      â””â”€ Context (æ‡‰ç”¨)     â”‚  â”‚  â† ä¸€å€‹ Web App
  â”‚  â”‚          â””â”€ Wrapper        â”‚  â”‚  â† ä¸€å€‹ Servlet
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚         ç·šç¨‹æ±  (Thread Pool)     â”‚  â† ä¸¦ç™¼è™•ç†
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  æ ¸å¿ƒè·è²¬ï¼ˆ5 ä»¶äº‹ï¼‰

  | è·è²¬     | èªªæ˜                           |
  |----------|--------------------------------|
  | ç›£è½     | ç›£è½ç«¯å£ï¼Œæ¥æ”¶ TCP é€£æ¥        |
  | è§£æ     | HTTP å ±æ–‡ â†’ HttpServletRequest |
  | è·¯ç”±     | URL â†’ å°æ‡‰çš„ Servlet           |
  | ç”Ÿå‘½é€±æœŸ | init() â†’ service() â†’ destroy() |
  | ä¸¦ç™¼     | ç·šç¨‹æ± è™•ç†å¤šå€‹è«‹æ±‚             |

  è«‹æ±‚è™•ç†æµç¨‹

  è«‹æ±‚ â†’ Connector â†’ Engine â†’ Host â†’ Context â†’ Wrapper â†’ Servlet.service()
                                                              â†“
  éŸ¿æ‡‰ â† Connector â† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Response

  ä¸€å¥è©±ç¸½çµï¼š

  Connector è² è²¬ã€Œé€šè¨Šã€ï¼ŒContainer è² è²¬ã€Œæ‰¾åˆ°ä¸¦åŸ·è¡Œ Servletã€ã€‚

  è¦æ·±å…¥ Connector é‚„æ˜¯ Containerï¼Ÿ

> ä¸ç”¨äº†ï¼Œå†è¬›è¬›Servletè¦ç¯„å§ï¼Œä¹Ÿè¦ä¸€å€‹ç¸½é«”æ¶æ§‹ï¼Œè¦æ±‚æº–ç¢ºï¼Œæ ¸å¿ƒï¼Œç°¡æ½”; 

â— Servlet è¦ç¯„æ ¸å¿ƒæ¶æ§‹

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                   Servlet è¦ç¯„                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚   æ ¸å¿ƒæ¥å£    â”‚   ç”Ÿå‘½é€±æœŸ    â”‚      çµ„ä»¶æ¨¡å‹          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Servlet      â”‚ init()       â”‚ Filter (éæ¿¾å™¨)        â”‚
  â”‚ HttpServlet  â”‚ service()    â”‚ Listener (ç›£è½å™¨)      â”‚
  â”‚ Request      â”‚ destroy()    â”‚ HttpSession (æœƒè©±)     â”‚
  â”‚ Response     â”‚              â”‚                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  æ ¸å¿ƒæ¥å£é—œä¿‚

          Servlet (æ¥å£)
              â†‘
        GenericServlet (æŠ½è±¡é¡)
              â†‘
        HttpServlet (æŠ½è±¡é¡)   â† é–‹ç™¼è€…ç¹¼æ‰¿é€™å€‹
              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
   doGet()        doPost()  ...

  è«‹æ±‚è™•ç†æ¨¡å‹

  Request â†’ Filteréˆ â†’ Servlet â†’ Filteréˆ â†’ Response
                â†“
           Listener ç›£è½å„ç¨®äº‹ä»¶

  ä¸‰å¤§æ ¸å¿ƒçµ„ä»¶

  | çµ„ä»¶     | ä½œç”¨                    | å…¸å‹å ´æ™¯               |
  |----------|-------------------------|------------------------|
  | Servlet  | è™•ç†è«‹æ±‚ï¼Œç”ŸæˆéŸ¿æ‡‰      | æ¥­å‹™é‚è¼¯               |
  | Filter   | æ””æˆªè«‹æ±‚/éŸ¿æ‡‰ï¼Œéˆå¼è™•ç† | èªè­‰ã€æ—¥èªŒã€ç·¨ç¢¼       |
  | Listener | ç›£è½ç”Ÿå‘½é€±æœŸäº‹ä»¶        | åˆå§‹åŒ–è³‡æºã€çµ±è¨ˆåœ¨ç·šæ•¸ |

  é…ç½®æ–¹å¼

  web.xml (å‚³çµ±)  â†â†’  è¨»è§£ (ç¾ä»£)
                      @WebServlet
                      @WebFilter
                      @WebListener

  ä¸€å¥è©±ç¸½çµï¼š

  Servlet è™•ç†è«‹æ±‚ï¼ŒFilter æ””æˆªè«‹æ±‚ï¼ŒListener ç›£è¯äº‹ä»¶ â€”â€” ä¸‰è€…æ§‹æˆ Java Web çš„åŸºç¤éª¨æ¶ã€‚


> å•Šï¼Œæˆ‘æ‰¾é€™å€‹çµ„ä»¶æ¨¡å‹å¥½ä¹…ï¼Œé‚„æœ‰é€™å€‹è«‹æ±‚è™•ç†æ¨¡å‹çš„é€™å€‹é †åºï¼Œä¸€ç›´å°éæ¿¾å™¨ï¼Œæ””
æˆªå™¨ï¼Œç›£è½å™¨çš„é †åºä¸æ¸…æ¥šï¼›é€™å€‹å¯ä»¥åœ¨å“ªå€‹å®˜ç¶²çœ‹åˆ°å—ï¼Ÿ 

â— å®˜æ–¹æ–‡æª”ä¾†æº

  1. Jakarta EE å®˜ç¶²ï¼ˆç¾è¡Œå®˜æ–¹ï¼‰
  - https://jakarta.ee/specifications/servlet/
  - Java EE å·²ç§»äº¤çµ¦ Eclipse åŸºé‡‘æœƒï¼Œæ”¹å Jakarta EE

  2. JCP å®˜ç¶²ï¼ˆæ­·å²è¦ç¯„ï¼‰
  - https://jcp.org/en/jsr/detail?id=369 ï¼ˆServlet 4.0ï¼‰
  - https://jcp.org/en/jsr/detail?id=340 ï¼ˆServlet 3.1ï¼‰

  3. è¦ç¯„ PDF ä¸‹è¼‰
  - Jakarta Servlet 6.0 Specï¼šhttps://jakarta.ee/specifications/servlet/6.0/

  ---
  âš ï¸ é‡è¦æ¾„æ¸…

  ä½ æåˆ°ã€Œéæ¿¾å™¨ã€æ””æˆªå™¨ã€ç›£è½å™¨ã€ï¼Œéœ€è¦å€åˆ†ï¼š

  | çµ„ä»¶                  | æ­¸å±¬                 | è¦ç¯„                      |
  |-----------------------|----------------------|---------------------------|
  | Filterï¼ˆéæ¿¾å™¨ï¼‰      | Servlet è¦ç¯„         | JSR 340 / Jakarta Servlet |
  | Listenerï¼ˆç›£è½å™¨ï¼‰    | Servlet è¦ç¯„         | JSR 340 / Jakarta Servlet |
  | Interceptorï¼ˆæ””æˆªå™¨ï¼‰ | âŒ ä¸æ˜¯ Servlet è¦ç¯„ | Spring æ¡†æ¶è‡ªå·±çš„æ¦‚å¿µ     |

  åŸ·è¡Œé †åºï¼ˆå« Springï¼‰

  Request â†’ Filter â†’ DispatcherServlet â†’ Interceptor â†’ Controller
                                                â†‘
                                           Spring å±¤

  æ‰€ä»¥ï¼š
  - Filter + Listener â†’ çœ‹ Servlet è¦ç¯„
  - Interceptor â†’ çœ‹ Spring å®˜æ–¹æ–‡æª”ï¼šhttps://docs.spring.io/spring-framework/reference/web/webmvc/mvc-config/interceptors.html

  é€™å€‹å€åˆ†å¾ˆé—œéµï¼Œå¾ˆå¤šäººæœƒæ··æ·†ï¼

> è¬è¬ä½ çš„æé†’ï¼Œé‚£æˆ‘å¦‚æœè¦ä¸€å€‹å…ˆå¾Œé †åºå‘¢ï¼Ÿç›£è½å™¨ï¼Œæ””æˆªå™¨ï¼Œéæ¿¾å™¨ï¼Œservletè‡ª
èº«ï¼›æœ‰ä¸€å€‹ç¸½çµçš„æ¡†æ¶å—ï¼Ÿ 

â— å®Œæ•´åŸ·è¡Œé †åºæ¡†æ¶

  æ‡‰ç”¨å•Ÿå‹•
      â”‚
      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ServletContextListener.contextInitialized()  (ç›£è½å™¨)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚  â† æ‡‰ç”¨é‹è¡Œä¸­ï¼Œè«‹æ±‚é€²ä¾†
      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ServletRequestListener.requestInitialized()  (ç›£è½å™¨)       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                             â”‚
  â”‚    Filter.doFilter() - å‰ç½®  â‘                               â”‚
  â”‚        â†“                                                    â”‚
  â”‚    Filter.doFilter() - å‰ç½®  â‘¡    (Filter éˆ)               â”‚
  â”‚        â†“                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  DispatcherServlet (Spring)                         â”‚    â”‚
  â”‚  â”‚      â†“                                              â”‚    â”‚
  â”‚  â”‚  HandlerInterceptor.preHandle()   â‘                  â”‚    â”‚
  â”‚  â”‚      â†“                                              â”‚    â”‚
  â”‚  â”‚  HandlerInterceptor.preHandle()   â‘¡  (æ””æˆªå™¨éˆ)     â”‚    â”‚
  â”‚  â”‚      â†“                                              â”‚    â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
  â”‚  â”‚  â”‚  Controller æ–¹æ³•åŸ·è¡Œ                       â”‚      â”‚    â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
  â”‚  â”‚      â†“                                              â”‚    â”‚
  â”‚  â”‚  HandlerInterceptor.postHandle()  â‘¡ â‘               â”‚    â”‚
  â”‚  â”‚      â†“                                              â”‚    â”‚
  â”‚  â”‚  HandlerInterceptor.afterCompletion() â‘¡ â‘           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚        â†“                                                    â”‚
  â”‚    Filter.doFilter() - å¾Œç½®  â‘¡                              â”‚
  â”‚        â†“                                                    â”‚
  â”‚    Filter.doFilter() - å¾Œç½®  â‘                               â”‚
  â”‚                                                             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  ServletRequestListener.requestDestroyed()  (ç›£è¯å™¨)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚  â† æ‡‰ç”¨é—œé–‰
      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ServletContextListener.contextDestroyed()  (ç›£è½å™¨)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ç°¡åŒ–è¨˜æ†¶å£è¨£

  ç›£è½å™¨ï¼ˆäº‹ä»¶è§¸ç™¼ï¼Œä¸åœ¨éˆä¸Šï¼‰
      â†“
  Filterï¼ˆServlet è¦ç¯„ï¼‰
      â†“
  Interceptorï¼ˆSpring å±¤ï¼‰
      â†“
  Controller

  æ ¸å¿ƒå€åˆ¥ç¸½çµ

  | çµ„ä»¶        | å±¤ç´š         | åŸ·è¡Œæ™‚æ©Ÿ               | å…¸å‹ç”¨é€”             |
  |-------------|--------------|------------------------|----------------------|
  | Listener    | Servlet å®¹å™¨ | äº‹ä»¶è§¸ç™¼ï¼ˆä¸æ””æˆªè«‹æ±‚ï¼‰ | åˆå§‹åŒ–è³‡æºã€çµ±è¨ˆ     |
  | Filter      | Servlet è¦ç¯„ | è«‹æ±‚é€²å…¥ Servlet å‰å¾Œ  | ç·¨ç¢¼ã€èªè­‰ã€æ—¥èªŒ     |
  | Interceptor | Spring MVC   | é€²å…¥ Controller å‰å¾Œ   | æ¬Šé™ã€æ—¥èªŒã€æ€§èƒ½ç›£æ§ |
  | AOP         | Spring       | æ–¹æ³•åŸ·è¡Œå‰å¾Œ           | äº‹å‹™ã€æ—¥èªŒ           |

  ä¸€å¥è©±ç¸½çµï¼š

  Listener è½äº‹ä»¶ï¼ŒFilter åŒ… Servletï¼ŒInterceptor åŒ… Controllerã€‚

  ç”±å¤–åˆ°å…§ï¼šFilter â†’ Interceptor â†’ Controller


> çˆ²ä»€éº¼è¦é€™éº¼å¤šçš„ä¸­é–“å±¤åŠ æ””æˆªæ“´å±•ï¼Ÿå®ƒå€‘å­˜åœ¨çš„æ„ç¾©æ˜¯å•¥ï¼Ÿ 
å°±æ˜¯å®ƒå€‘èª•ç”Ÿçš„èƒŒæ™¯æ˜¯å•¥ï¼Ÿ 

â— èª•ç”ŸèƒŒæ™¯ï¼šä¸€å€‹æ¼”é€²çš„æ•…äº‹

  æœ€åˆçš„ç—›é»

  // æ—©æœŸï¼šæ‰€æœ‰é‚è¼¯éƒ½å¯«åœ¨ Servlet è£¡
  public class OrderServlet extends HttpServlet {
      void doPost() {
          // 1. æª¢æŸ¥ç™»éŒ„ â† é‡è¤‡
          // 2. è¨˜éŒ„æ—¥èªŒ â† é‡è¤‡
          // 3. è¨­ç½®ç·¨ç¢¼ â† é‡è¤‡
          // 4. æ¥­å‹™é‚è¼¯ â† çœŸæ­£è¦åšçš„äº‹
          // 5. è¨˜éŒ„æ—¥èªŒ â† é‡è¤‡
      }
  }

  public class UserServlet extends HttpServlet {
      void doPost() {
          // 1. æª¢æŸ¥ç™»éŒ„ â† åˆå¯«ä¸€é
          // 2. è¨˜éŒ„æ—¥èªŒ â† åˆå¯«ä¸€é
          // 3. è¨­ç½®ç·¨ç¢¼ â† åˆå¯«ä¸€é
          // 4. æ¥­å‹™é‚è¼¯
          // 5. è¨˜éŒ„æ—¥èªŒ â† åˆå¯«ä¸€é
      }
  }

  å•é¡Œï¼šå¤§é‡é‡è¤‡ä»£ç¢¼ï¼Œæ”¹ä¸€è™•è¦æ”¹ N è™•ã€‚

  ---
  è§£æ±ºæ€è·¯ï¼šæŠ½é›¢ã€Œæ©«åˆ‡é—œæ³¨é»ã€

          æ¥­å‹™A    æ¥­å‹™B    æ¥­å‹™C
            â”‚        â”‚        â”‚
    â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•  â† æ—¥èªŒï¼ˆæ©«åˆ‡ï¼‰
            â”‚        â”‚        â”‚
    â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•  â† èªè­‰ï¼ˆæ©«åˆ‡ï¼‰
            â”‚        â”‚        â”‚
    â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•  â† äº‹å‹™ï¼ˆæ©«åˆ‡ï¼‰
            â”‚        â”‚        â”‚
            â–¼        â–¼        â–¼

  é€™äº›ã€Œæ©«è‘—åˆ‡éæ‰€æœ‰æ¥­å‹™ã€çš„é‚è¼¯ï¼Œå°±å« æ©«åˆ‡é—œæ³¨é» (Cross-Cutting Concerns)ã€‚

  ---
  ç‚ºä»€éº¼éœ€è¦å¤šå±¤ï¼Ÿ

  | å±¤ç´š        | æ§åˆ¶ç²’åº¦               | èª•ç”ŸåŸå›                                  |
  |-------------|------------------------|------------------------------------------|
  | Filter      | æ‰€æœ‰è«‹æ±‚ï¼ˆå«éœæ…‹è³‡æºï¼‰ | Servlet è¦ç¯„åŸç”Ÿæ”¯æŒï¼Œæœ€é€šç”¨             |
  | Interceptor | åªé‡å° Controller      | Spring éœ€è¦æ›´ç´°ç²’åº¦ + è¨ªå• Spring ä¸Šä¸‹æ–‡ |
  | AOP         | æ–¹æ³•ç´šåˆ¥               | æ›´ç´°ç²’åº¦ï¼Œä»»æ„æ–¹æ³•éƒ½èƒ½åˆ‡å…¥               |

  ä¸€å€‹æ¯”å–»ï¼š

  æ©Ÿå ´å®‰æª¢æµç¨‹ï¼š

  Filter      = æ©Ÿå ´å¤§é–€å®‰æª¢ï¼ˆæ‰€æœ‰äººéƒ½éï¼‰
  Interceptor = ç™»æ©Ÿå£æª¢æŸ¥ï¼ˆåªé‡å°ä¹˜å®¢ï¼‰
  AOP         = ç‰¹å®šäººå“¡äºŒæ¬¡æª¢æŸ¥ï¼ˆç²¾æº–æ””æˆªï¼‰

  ---
  æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

  | åŸå‰‡         | é«”ç¾                                             |
  |--------------|--------------------------------------------------|
  | DRY (ä¸é‡è¤‡) | å…¬å…±é‚è¼¯åªå¯«ä¸€æ¬¡                                 |
  | å–®ä¸€è·è²¬     | æ¯å±¤åªåšä¸€ä»¶äº‹                                   |
  | é–‹é–‰åŸå‰‡     | åŠ æ–°åŠŸèƒ½ä¸æ”¹åŸä»£ç¢¼ï¼ŒåŠ å€‹ Filter/Interceptor å°±è¡Œ |

  ---
  ä¸€å¥è©±ç¸½çµï¼š

  å®ƒå€‘çš„å­˜åœ¨æ˜¯ç‚ºäº†æŠŠã€Œæ¯å€‹è«‹æ±‚éƒ½è¦åšçš„äº‹ã€å¾æ¥­å‹™ä»£ç¢¼ä¸­æŠ½é›¢å‡ºä¾†ï¼Œå¯¦ç¾ä¸€æ¬¡ç·¨å¯«ã€è™•è™•ç”Ÿæ•ˆã€‚


> Interceptorï¼Œä½ å¯ä»¥è©³ç´°è¬›è¬›Interceptorå—ï¼Ÿçˆ²ä»€éº¼Springè¦ç¨ç«‹æå‡ºè‡ªå·±çš„è¦ç¯„
ï¼Œå®ƒå’Œjsrçš„è¦ç¯„æœ‰ä»€éº¼ä¸åŒï¼Œé—œè¯åˆæ˜¯ä»€éº¼ï¼Ÿ 

â— Spring Interceptor æ·±åº¦è§£æ

  ç‚ºä»€éº¼ Spring è¦è‡ªå·±æä¸€å¥—ï¼Ÿ

  Filter çš„å±€é™æ€§

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              Servlet å®¹å™¨ (Tomcat)                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Filterï¼ˆåªèƒ½çœ‹åˆ° Request/Responseï¼‰            â”‚  â”‚
  â”‚  â”‚      â†“                                         â”‚  â”‚
  â”‚  â”‚      ?  â† çœ‹ä¸åˆ° Spring çš„ä»»ä½•æ±è¥¿              â”‚  â”‚
  â”‚  â”‚      â†“                                         â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚         Spring å®¹å™¨                       â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  DispatcherServlet                 â”‚  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚      â†“                             â”‚  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  Interceptor â† èƒ½çœ‹åˆ° Handler è³‡è¨Š  â”‚  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚      â†“                             â”‚  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  Controller                        â”‚  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Filter åšä¸åˆ°çš„äº‹ï¼ŒInterceptor èƒ½åš

  // Interceptor å¯ä»¥æ‹¿åˆ°é€™äº›è³‡è¨Š
  public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response,
                           Object handler) {  // â† é—œéµï¼

      HandlerMethod method = (HandlerMethod) handler;

      // 1. æ‹¿åˆ° Controller é¡
      Class<?> controllerClass = method.getBeanType();

      // 2. æ‹¿åˆ°æ–¹æ³•å
      String methodName = method.getMethod().getName();

      // 3. æ‹¿åˆ°æ–¹æ³•ä¸Šçš„è¨»è§£
      RequireLogin annotation = method.getMethodAnnotation(RequireLogin.class);

      // 4. è¨ªå• Spring Bean
      UserService userService = applicationContext.getBean(UserService.class);

      // Filter å®Œå…¨åšä¸åˆ°ä»¥ä¸Šé€™äº›ï¼
  }

  ---
  Filter vs Interceptor æ ¸å¿ƒå€åˆ¥

  | ç¶­åº¦                 | Filter                 | Interceptor                       |
  |----------------------|------------------------|-----------------------------------|
  | è¦ç¯„                 | Servlet (JSR)          | Spring è‡ªå®šç¾©                     |
  | ç®¡ç†è€…               | Servlet å®¹å™¨           | Spring å®¹å™¨                       |
  | ä½œç”¨ç¯„åœ             | æ‰€æœ‰è«‹æ±‚ï¼ˆå«éœæ…‹è³‡æºï¼‰ | åªæœ‰é€²å…¥ DispatcherServlet çš„è«‹æ±‚ |
  | èƒ½å¦è¨ªå• Handler     | âŒ ä¸èƒ½                | âœ… èƒ½                             |
  | èƒ½å¦æ³¨å…¥ Spring Bean | âš ï¸ éº»ç…©                | âœ… ç›´æ¥æ³¨å…¥                       |
  | åŸ·è¡Œä½ç½®             | Servlet ä¹‹å¤–           | Servlet ä¹‹å…§                      |

  ---
  JSR ä¸­ä¹Ÿæœ‰ Interceptorï¼Ÿ

  æ˜¯çš„ï¼ŒJava EE æœ‰è‡ªå·±çš„ Interceptor è¦ç¯„ï¼š

  | è¦ç¯„    | èªªæ˜             | æ‡‰ç”¨å ´æ™¯          |
  |---------|------------------|-------------------|
  | JSR 318 | EJB Interceptors | EJB æ–¹æ³•æ””æˆª      |
  | JSR 345 | CDI Interceptors | CDI Bean æ–¹æ³•æ””æˆª |

  Spring Interceptor vs JSR Interceptor

  JSR Interceptor (CDI/EJB)
  â”œâ”€â”€ åŸºæ–¼ AOP æ¦‚å¿µ
  â”œâ”€â”€ æ””æˆªä»»æ„ Bean æ–¹æ³•
  â”œâ”€â”€ ä½¿ç”¨ @Interceptor + @AroundInvoke
  â””â”€â”€ ä¾è³´ Java EE å®¹å™¨

  Spring MVC Interceptor
  â”œâ”€â”€ å°ˆé–€é‡å° Web è«‹æ±‚
  â”œâ”€â”€ åªæ””æˆª Controller
  â”œâ”€â”€ ä½¿ç”¨ HandlerInterceptor æ¥å£
  â””â”€â”€ åªä¾è³´ Spring

  ç‚ºä»€éº¼ Spring ä¸ç”¨ JSR Interceptorï¼Ÿ

  1. å®šä½ä¸åŒï¼šJSR Interceptor æ˜¯é€šç”¨æ–¹æ³•æ””æˆªï¼ŒSpring Interceptor å°ˆç‚º Web è¨­è¨ˆ
  2. è¼•é‡ï¼šä¸éœ€è¦å®Œæ•´çš„ Java EE å®¹å™¨
  3. Web å°ˆç”¨ APIï¼šç›´æ¥æä¾› HttpServletRequestã€Handler ç­‰

  ---
  Spring èˆ‡ JSR çš„é—œä¿‚

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      Spring çš„æ…‹åº¦                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                         â”‚
  â”‚   JSR è¦ç¯„å¥½ç”¨ â†’ ç›´æ¥æ”¯æŒï¼ˆå¦‚ JSR 330 @Injectï¼‰          â”‚
  â”‚                                                         â”‚
  â”‚   JSR è¦ç¯„ä¸å¤ ç”¨ â†’ è‡ªå·±æ“´å±•ï¼ˆå¦‚ Interceptorï¼‰            â”‚
  â”‚                                                         â”‚
  â”‚   JSR è¦ç¯„å¤ªé‡ â†’ æä¾›è¼•é‡æ›¿ä»£ï¼ˆå¦‚ä¸ç”¨ EJBï¼‰              â”‚
  â”‚                                                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Spring æ”¯æŒçš„ JSR

  | JSR         | èªªæ˜                      | Spring æ…‹åº¦       |
  |-------------|---------------------------|-------------------|
  | JSR 330     | @Inject, @Named           | âœ… å®Œå…¨æ”¯æŒ       |
  | JSR 250     | @PostConstruct, @Resource | âœ… å®Œå…¨æ”¯æŒ       |
  | JSR 380     | Bean Validation           | âœ… å®Œå…¨æ”¯æŒ       |
  | JSR 318/345 | EJB/CDI Interceptor       | âŒ è‡ªå·±å¯¦ç¾äº†ä¸€å¥— |

  ---
  ä¸€å¥è©±ç¸½çµ

  Filter åœ¨ Servlet å±¤çœ‹é–€ï¼Œçœ‹ä¸åˆ° Spring å…§éƒ¨ï¼›Interceptor åœ¨ Spring å±¤çœ‹é–€ï¼Œèƒ½çœ‹åˆ° Controller çš„ä¸€åˆ‡ã€‚

  Spring é€  Interceptor ä¸æ˜¯ç‚ºäº†å°æŠ— JSRï¼Œè€Œæ˜¯ Filter æ»¿è¶³ä¸äº† Spring MVC çš„éœ€æ±‚ã€‚


> Interceptor â† èƒ½çœ‹åˆ° Handler 
è³‡è¨Šï¼Œé€™å€‹æ˜¯å•¥æ„æ€ï¼ŸHandleråˆæ˜¯ä»€éº¼ï¼Ÿçˆ²ä»€éº¼åªæœ‰Springçš„interceptroå¯ä»¥çœ‹åˆ°ï¼Ÿ
 

â— Handler æ˜¯ä»€éº¼ï¼Ÿ

  ç°¡å–®èªªï¼šHandler = è™•ç†è«‹æ±‚çš„æ±è¥¿ = ä½ å¯«çš„ Controller æ–¹æ³•

  @RestController
  public class UserController {

      @GetMapping("/user/{id}")
      public User getUser(@PathVariable Long id) {  // â† é€™æ•´å€‹æ–¹æ³•å°±æ˜¯ä¸€å€‹ Handler
          return userService.findById(id);
      }
  }

  Spring æŠŠé€™å€‹æ–¹æ³•åŒ…è£æˆ HandlerMethod å°è±¡ï¼š

  HandlerMethod {
      bean: UserController å¯¦ä¾‹
      method: getUser()
      parameters: [id]
      annotations: [@GetMapping, ...]
      returnType: User
  }

  ---
  ç‚ºä»€éº¼ Filter çœ‹ä¸åˆ°ï¼ŒInterceptor èƒ½çœ‹åˆ°ï¼Ÿ

  é—œéµï¼šåŸ·è¡Œæ™‚æ©Ÿä¸åŒ

  è«‹æ±‚: GET /user/123

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     Servlet å®¹å™¨                         â”‚
      â”‚                                                         â”‚
      â”‚   Filter åŸ·è¡Œé»                                          â”‚
      â”‚       â”‚                                                 â”‚
      â”‚       â–¼                                                 â”‚
      â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚   â”‚ Filter.doFilter()                               â”‚   â”‚
      â”‚   â”‚                                                 â”‚   â”‚
      â”‚   â”‚   æ­¤æ™‚åªçŸ¥é“ï¼š                                    â”‚   â”‚
      â”‚   â”‚   - URL: /user/123                              â”‚   â”‚
      â”‚   â”‚   - Method: GET                                 â”‚   â”‚
      â”‚   â”‚   - Headers, Params...                          â”‚   â”‚
      â”‚   â”‚                                                 â”‚   â”‚
      â”‚   â”‚   âŒ ä¸çŸ¥é“ï¼šèª°ä¾†è™•ç†é€™å€‹è«‹æ±‚ï¼Ÿ                    â”‚   â”‚
      â”‚   â”‚                                                 â”‚   â”‚
      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚       â”‚                                                 â”‚
      â”‚       â–¼                                                 â”‚
      â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚   â”‚            DispatcherServlet                    â”‚   â”‚
      â”‚   â”‚                                                 â”‚   â”‚
      â”‚   â”‚   1. æ¥æ”¶è«‹æ±‚                                    â”‚   â”‚
      â”‚   â”‚              â†“                                  â”‚   â”‚
      â”‚   â”‚   2. HandlerMapping æŸ¥æ‰¾     â† é€™ä¸€æ­¥æ‰¾åˆ° Handler â”‚   â”‚
      â”‚   â”‚      "GET /user/123 â†’ UserController.getUser()" â”‚   â”‚
      â”‚   â”‚              â†“                                  â”‚   â”‚
      â”‚   â”‚   3. Interceptor.preHandle(request, response,   â”‚   â”‚
      â”‚   â”‚                            handler) â† å‚³å…¥!     â”‚   â”‚
      â”‚   â”‚              â†“                                  â”‚   â”‚
      â”‚   â”‚   4. åŸ·è¡Œ Handler (Controller)                  â”‚   â”‚
      â”‚   â”‚                                                 â”‚   â”‚
      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ---
  æ›´ç›´è§€çš„æ¯”å–»

  å¿«éé…é€æµç¨‹ï¼š

  Filterï¼ˆé–€è¡›ï¼‰
  â”œâ”€â”€ å¿«éåˆ°é”å°å€å¤§é–€
  â”œâ”€â”€ é–€è¡›åªçœ‹åˆ°ï¼šä¸€å€‹åŒ…è£¹ï¼Œå¯«è‘—ã€Œ3è™Ÿæ¨“ã€
  â”œâ”€â”€ âŒ ä¸çŸ¥é“ï¼šå…·é«”èª°æ”¶ï¼Ÿå“ªå€‹æˆ¿é–“ï¼Ÿ
  â””â”€â”€ è·è²¬ï¼šæª¢æŸ¥é•ç¦å“ã€ç™»è¨˜é€²å…¥

  DispatcherServletï¼ˆå¿«éç«™ï¼‰
  â”œâ”€â”€ åŒ…è£¹åˆ°é”å¿«éç«™
  â”œâ”€â”€ æŸ¥è©¢ç³»çµ±ï¼šã€Œ3è™Ÿæ¨“ â†’ å¼µä¸‰ â†’ 302å®¤ã€  â† ç›¸ç•¶æ–¼ HandlerMapping
  â””â”€â”€ ç¾åœ¨çŸ¥é“å…·é«”æ”¶ä»¶äººäº†

  Interceptorï¼ˆæ¨“é“ç®¡ç†å“¡ï¼‰
  â”œâ”€â”€ å¿«éå“¡ä¸Šæ¨“é€ä»¶
  â”œâ”€â”€ âœ… çŸ¥é“ï¼šé€çµ¦èª°ã€ä»€éº¼æ±è¥¿ã€æ”¶ä»¶äººä¿¡æ¯
  â””â”€â”€ è·è²¬ï¼šæª¢æŸ¥æ”¶ä»¶äººæ˜¯å¦åœ¨å®¶ã€æ˜¯å¦æœ‰æ¬Šæ”¶ä»¶

  ---
  ä»£ç¢¼å°æ¯”

  // Filter - çœ‹ä¸åˆ° Handler
  public class MyFilter implements Filter {
      @Override
      public void doFilter(ServletRequest request, 
                           ServletResponse response, 
                           FilterChain chain) {

          HttpServletRequest req = (HttpServletRequest) request;

          // åªèƒ½çœ‹åˆ°é€™äº›
          String url = req.getRequestURI();      // "/user/123"
          String method = req.getMethod();        // "GET"

          // âŒ ç„¡æ³•çŸ¥é“
          // - å“ªå€‹ Controller è™•ç†ï¼Ÿ
          // - å“ªå€‹æ–¹æ³•è™•ç†ï¼Ÿ
          // - æ–¹æ³•ä¸Šæœ‰ä»€éº¼è¨»è§£ï¼Ÿ
      }
  }

  // Interceptor - èƒ½çœ‹åˆ° Handler
  public class MyInterceptor implements HandlerInterceptor {
      @Override
      public boolean preHandle(HttpServletRequest request,
                               HttpServletResponse response,
                               Object handler) {  // â† é—œéµåƒæ•¸ï¼

          if (handler instanceof HandlerMethod) {
              HandlerMethod hm = (HandlerMethod) handler;

              // âœ… å…¨éƒ½èƒ½çœ‹åˆ°
              String controllerName = hm.getBeanType().getSimpleName();  // "UserController"
              String methodName = hm.getMethod().getName();               // "getUser"

              // âœ… èƒ½æ‹¿åˆ°æ–¹æ³•ä¸Šçš„è¨»è§£
              RequireAdmin annotation = hm.getMethodAnnotation(RequireAdmin.class);
              if (annotation != null && !currentUser.isAdmin()) {
                  response.sendError(403);
                  return false;
              }
          }
          return true;
      }
  }

  ---
  é€™æœ‰ä»€éº¼ç”¨ï¼Ÿ

  å ´æ™¯ï¼šåŸºæ–¼è¨»è§£çš„æ¬Šé™æ§åˆ¶

  // Controller
  @RestController
  public class AdminController {

      @RequireAdmin          // â† è‡ªå®šç¾©è¨»è§£
      @GetMapping("/admin/data")
      public Data getAdminData() { ... }
  }

  // Interceptor
  public class AuthInterceptor implements HandlerInterceptor {
      @Override
      public boolean preHandle(..., Object handler) {
          HandlerMethod hm = (HandlerMethod) handler;

          // æª¢æŸ¥æ–¹æ³•ä¸Šæ˜¯å¦æœ‰ @RequireAdmin
          if (hm.hasMethodAnnotation(RequireAdmin.class)) {
              if (!isAdmin()) {
                  return false;  // æ””æˆªï¼
              }
          }
          return true;
      }
  }

  Filter åšä¸åˆ°é€™ä»¶äº‹ï¼Œå› ç‚ºå®ƒæ ¹æœ¬ä¸çŸ¥é“è¦åŸ·è¡Œçš„æ˜¯å“ªå€‹æ–¹æ³•ã€‚

  ---
  ä¸€å¥è©±ç¸½çµ

  Handler å°±æ˜¯ Controller æ–¹æ³•ã€‚Filter åŸ·è¡Œæ™‚ Spring é‚„æ²’è§£æå‡º Handlerï¼›Interceptor åŸ·è¡Œæ™‚ Spring å·²ç¶“çŸ¥é“ã€Œèª°ä¾†è™•ç†ã€ï¼Œæ‰€ä»¥èƒ½æŠŠ Handler å‚³çµ¦ä½ ã€‚


> é‚£æˆ‘ç†è§£æ˜¯java 
EEåªæ˜¯æ‰“äº†ä¸€å€‹åœ°åŸºï¼Œè€ŒSpringæ˜¯åœ¨åœ°åŸºä¸Šå»ºäº†å°å€ï¼Œæœ‰å…·é«”çš„æˆ¿è™Ÿï¼Ÿ 

â— é€™å€‹æ¯”å–»éå¸¸æº–ç¢ºï¼å¯ä»¥å†å»¶ä¼¸ä¸€ä¸‹ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                        Java EE (åœ°åŸº)                        â”‚
  â”‚                                                             â”‚
  â”‚   Servlet è¦ç¯„ï¼š                                             â”‚
  â”‚   - å®šç¾©äº†ã€Œè«‹æ±‚é€²ä¾†ã€éŸ¿æ‡‰å‡ºå»ã€çš„æ¨™æº–                          â”‚
  â”‚   - æä¾›äº† Filterã€Listener ç­‰åŸºç¤è¨­æ–½                        â”‚
  â”‚   - ä½†åªçŸ¥é“ã€Œæœ‰äººä¾†äº†ã€ï¼Œä¸çŸ¥é“ã€Œæ‰¾èª°ã€                         â”‚
  â”‚                                                             â”‚
  â”‚   ç›¸ç•¶æ–¼ï¼š                                                   â”‚
  â”‚   - å°å€æœ‰å¤§é–€ã€æœ‰è·¯ã€æœ‰é–€è¡›                                   â”‚
  â”‚   - ä½†æ²’æœ‰æ¨“æ£Ÿè¦åŠƒï¼Œæ²’æœ‰é–€ç‰Œè™Ÿ                                 â”‚
  â”‚                                                             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        Spring (å°å€)                         â”‚
  â”‚                                                             â”‚
  â”‚   Spring MVCï¼š                                               â”‚
  â”‚   - è¦åŠƒäº†æ¨“æ£Ÿ (Controller)                                  â”‚
  â”‚   - æ¨™è¨»äº†é–€ç‰Œè™Ÿ (@RequestMapping)                           â”‚
  â”‚   - è¨­ç«‹äº†ç‰©æ¥­ä¸­å¿ƒ (DispatcherServlet)                        â”‚
  â”‚   - å»ºç«‹äº†ä½æˆ¶åå†Š (HandlerMapping)                           â”‚
  â”‚                                                             â”‚
  â”‚   æ‰€ä»¥ï¼š                                                     â”‚
  â”‚   - çŸ¥é“ã€ŒGET /user/123 â†’ 3è™Ÿæ¨“302å®¤å¼µä¸‰ã€                    â”‚
  â”‚   - æ¨“é“ç®¡ç†å“¡ (Interceptor) èƒ½çœ‹åˆ°å…·é«”é–€ç‰Œ                    â”‚
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  è§’è‰²å°æ‡‰

  | æ¯”å–»       | Java EE     | Spring            |
  |------------|-------------|-------------------|
  | åœ°åŸº       | Servlet API | -                 |
  | å¤§é–€é–€è¡›   | Filter      | -                 |
  | ç‰©æ¥­ä¸­å¿ƒ   | -           | DispatcherServlet |
  | ä½æˆ¶åå†Š   | -           | HandlerMapping    |
  | æ¨“æ£Ÿ       | -           | Controller        |
  | é–€ç‰Œè™Ÿ     | -           | @RequestMapping   |
  | æ¨“é“ç®¡ç†å“¡ | -           | Interceptor       |
  | ä½æˆ¶       | -           | Handler (æ–¹æ³•)    |

  ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼Ÿ

  Java EE çš„è¨­è¨ˆå“²å­¸ï¼š
  ã€Œæˆ‘åªå®šç¾©æ¨™æº–ï¼Œä¸ç®¡ä½ å…§éƒ¨æ€éº¼çµ„ç¹”ã€

  Spring çš„è¨­è¨ˆå“²å­¸ï¼š
  ã€Œæˆ‘åœ¨æ¨™æº–ä¹‹ä¸Šï¼Œå¹«ä½ æŠŠå…§éƒ¨çµ„ç¹”å¥½ã€

  ---
  ä¸€å¥è©±ç¸½çµï¼š

  Java EE æ˜¯æ¯›å¯æˆ¿æ¨™æº–ï¼ŒSpring æ˜¯ç²¾è£ä¿®æ–¹æ¡ˆã€‚åœ°åŸºä¸€æ¨£ï¼Œä½† Spring è®“ä½ çŸ¥é“æ¯å€‹æˆ¿é–“ä½çš„æ˜¯èª°ã€‚

  ä½ çš„ç†è§£å®Œå…¨æ­£ç¢º ğŸ‘

> æˆ‘è¨˜å¾—javaEEæœ‰Servletï¼Œæ‡‰è©²å¯ä»¥æ‰¾åˆ°å…·é«”çš„è™•ç†é‚è¼¯å§ï¼Ÿ 

â— ä½ èªªå¾—å°ï¼Servlet ç¢ºå¯¦èƒ½æ‰¾åˆ°è™•ç†é‚è¼¯ã€‚é—œéµæ˜¯ç²’åº¦ä¸åŒï¼š

  åŸç”Ÿ Servlet çš„æ–¹å¼

  web.xml é…ç½®ï¼š

  /user/*   â†’ UserServlet
  /order/*  â†’ OrderServlet

  public class UserServlet extends HttpServlet {

      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
          String path = req.getPathInfo();

          // å…§éƒ¨é‚„è¦è‡ªå·±åˆ¤æ–·
          if (path.equals("/list")) {
              // è™•ç†ç”¨æˆ¶åˆ—è¡¨
          } else if (path.equals("/detail")) {
              // è™•ç†ç”¨æˆ¶è©³æƒ…
          } else if (path.equals("/delete")) {
              // è™•ç†åˆªé™¤ç”¨æˆ¶
          }
          // ... ä¸€å † if-else
      }
  }

  Filter èƒ½çœ‹åˆ°ï¼šé€™å€‹è«‹æ±‚äº¤çµ¦ UserServlet
  Filter çœ‹ä¸åˆ°ï¼šUserServlet å…§éƒ¨èµ°å“ªå€‹åˆ†æ”¯

  ---
  Spring MVC çš„æ–¹å¼

  @RestController
  @RequestMapping("/user")
  public class UserController {

      @GetMapping("/list")           // â† æ¯å€‹æ–¹æ³•å°±æ˜¯ä¸€å€‹ Handler
      public List<User> list() { }

      @GetMapping("/detail/{id}")    // â† ç²¾ç¢ºåˆ°æ–¹æ³•
      public User detail(@PathVariable Long id) { }

      @DeleteMapping("/{id}")        // â† ä¸ç”¨å¯« if-else
      public void delete(@PathVariable Long id) { }
  }

  Interceptor èƒ½çœ‹åˆ°ï¼šé€™å€‹è«‹æ±‚äº¤çµ¦ UserController.detail() æ–¹æ³•

  ---
  å°æ¯”åœ–

  åŸç”Ÿ Servlet (ç²—ç²’åº¦)
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  GET /user/list    â”€â”€â”               â”‚    UserServlet      â”‚
  GET /user/detail  â”€â”€â”¼â”€â”€â†’ Filter â”€â”€â†’ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  DELETE /user/123  â”€â”€â”˜               â”‚  â”‚  if-else åˆ†ç™¼  â”‚  â”‚
                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                          â†‘           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     åªçŸ¥é“åˆ°é€™è£¡


  Spring MVC (ç´°ç²’åº¦)
                                                      â”Œâ”€â”€â†’ list()
  GET /user/list    â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  GET /user/detail  â”€â”€â”¼â”€â”€â†’ Filter â”€â”€â†’ â”‚ Dispatcher â”‚â”€â”€â”¼â”€â”€â†’ detail()
  DELETE /user/123  â”€â”€â”˜               â”‚  Servlet   â”‚  â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â†’ delete()
                                            â”‚
                                      Interceptor åœ¨é€™è£¡
                                      çŸ¥é“å…·é«”æ˜¯å“ªå€‹æ–¹æ³•

  ---
  æœ¬è³ªå€åˆ¥

  | ç¶­åº¦             | åŸç”Ÿ Servlet        | Spring MVC            |
  |------------------|---------------------|-----------------------|
  | æ˜ å°„ç²’åº¦         | URL â†’ Servletï¼ˆé¡ï¼‰ | URL â†’ Handlerï¼ˆæ–¹æ³•ï¼‰ |
  | åˆ†ç™¼é‚è¼¯         | è‡ªå·±å¯« if-else      | æ¡†æ¶è‡ªå‹•è™•ç†          |
  | Filter å¯è¦‹      | å“ªå€‹ Servlet        | å“ªå€‹ Servlet          |
  | Interceptor å¯è¦‹ | -                   | å“ªå€‹æ–¹æ³• + è¨»è§£       |

  ---
  ä¸€å¥è©±ç¸½çµï¼š

  Servlet æ˜¯ã€Œä¸€å€‹é¡è™•ç†ä¸€é¡è«‹æ±‚ã€ï¼ŒSpring æ˜¯ã€Œä¸€å€‹æ–¹æ³•è™•ç†ä¸€å€‹è«‹æ±‚ã€ã€‚Filter åªèƒ½çœ‹åˆ°é¡ï¼ŒInterceptor èƒ½çœ‹åˆ°æ–¹æ³•ã€‚

  ä½ çš„ç†è§£æ²’éŒ¯ï¼Œåªæ˜¯ç²’åº¦çš„å·®ç•°ï¼

> æˆ‘æ„Ÿè¦ºå¾ˆç°¡å–®å•Šï¼Œå°±æ˜¯æŠŠServletçš„urlçµ¦åˆ†é¡è™•ç†ä¸€ä¸‹å°±è¡Œäº†å•Šï¼Œåªè¦æ””æˆªurlå°å¾Œ
é¢çš„urlåšä¸€å€‹åŒ¹é…ï¼Œæ¯å€‹å”¯ä¸€çš„å¾Œç¶´åŒ¹é…å”¯ä¸€çš„ç­–ç•¥å»è™•ç†è€Œå·² 

â— ä½ èªªå¾—å°ï¼ŒURL è·¯ç”±æœ¬èº«ç¢ºå¯¦å¾ˆç°¡å–®ã€‚ä½† Spring MVC çš„åƒ¹å€¼ä¸åœ¨è·¯ç”±ï¼Œè€Œåœ¨è·¯ç”±ä¹‹å¾Œçš„äº‹æƒ…ï¼š

  å¦‚æœè‡ªå·±å¯¦ç¾

  public class UserServlet extends HttpServlet {

      protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
          String path = req.getPathInfo();

          // 1. URL åŒ¹é…ï¼ˆä½ èªªçš„é€™éƒ¨åˆ†ï¼Œç¢ºå¯¦ç°¡å–®ï¼‰
          if (path.matches("/detail/\\d+")) {

              // 2. åƒæ•¸æå–ï¼ˆé–‹å§‹éº»ç…©äº†ï¼‰
              String idStr = path.split("/")[2];
              Long id = Long.parseLong(idStr);

              // 3. èª¿ç”¨æ¥­å‹™é‚è¼¯
              User user = userService.findById(id);

              // 4. è¿”å›å€¼è™•ç†ï¼ˆæ›´éº»ç…©ï¼‰
              resp.setContentType("application/json");
              resp.setCharacterEncoding("UTF-8");
              String json = objectMapper.writeValueAsString(user);
              resp.getWriter().write(json);

          } else if (path.matches("/search")) {

              // 5. æŸ¥è©¢åƒæ•¸æå–
              String name = req.getParameter("name");
              Integer age = Integer.parseInt(req.getParameter("age"));  // ç©ºå€¼ï¼Ÿç•°å¸¸ï¼Ÿ
              Integer page = req.getParameter("page") != null
                           ? Integer.parseInt(req.getParameter("page"))
                           : 1;  // é»˜èªå€¼è™•ç†

              // 6. åƒæ•¸é©—è­‰
              if (name == null || name.isEmpty()) {
                  resp.sendError(400, "name is required");
                  return;
              }

              // 7. ç•°å¸¸è™•ç†
              try {
                  List<User> users = userService.search(name, age, page);
                  // ... åˆè¦åºåˆ—åŒ–
              } catch (Exception e) {
                  resp.sendError(500, e.getMessage());
              }
          }
      }
  }

  Spring MVC çš„å¯«æ³•

  @RestController
  @RequestMapping("/user")
  public class UserController {

      @GetMapping("/detail/{id}")
      public User detail(@PathVariable Long id) {  // è‡ªå‹•æå–ã€è‡ªå‹•è½‰å‹
          return userService.findById(id);          // è‡ªå‹•åºåˆ—åŒ– JSON
      }

      @GetMapping("/search")
      public List<User> search(
              @RequestParam String name,                      // è‡ªå‹•æå–
              @RequestParam Integer age,                      // è‡ªå‹•è½‰å‹
              @RequestParam(defaultValue = "1") Integer page, // é»˜èªå€¼
              @Valid @RequestBody SearchDTO dto) {            // è‡ªå‹•é©—è­‰
          return userService.search(name, age, page);
      }
  }

  ---
  Spring è‡ªå‹•è™•ç†çš„äº‹æƒ…

  | ä½ è¦åšçš„     | è‡ªå·±å¯«             | Spring            |
  |--------------|--------------------|-------------------|
  | URL è·¯ç”±     | ç°¡å–® if-else       | @GetMapping       |
  | è·¯å¾‘åƒæ•¸æå– | æ‰‹å‹•è§£æ           | @PathVariable     |
  | æŸ¥è©¢åƒæ•¸æå– | getParameter()     | @RequestParam     |
  | é¡å‹è½‰æ›     | Integer.parseInt() | è‡ªå‹•              |
  | ç©ºå€¼/é»˜èªå€¼  | ä¸€å †åˆ¤æ–·           | defaultValue      |
  | è«‹æ±‚é«”è§£æ   | æ‰‹å‹•è®€æµ+ååºåˆ—åŒ–  | @RequestBody      |
  | åƒæ•¸é©—è­‰     | æ‰‹å‹• if åˆ¤æ–·       | @Valid            |
  | è¿”å›å€¼åºåˆ—åŒ– | æ‰‹å‹• JSON          | è‡ªå‹•              |
  | ç•°å¸¸è™•ç†     | try-catch åˆ°è™•å¯«   | @ExceptionHandler |
  | å…§å®¹å”å•†     | æ‰‹å‹•åˆ¤æ–· Accept    | è‡ªå‹•              |

  ---
  ä¸€å¥è©±ç¸½çµ

  URL è·¯ç”±ç¢ºå¯¦ç°¡å–®ï¼Œä½†ã€Œåƒæ•¸æ€éº¼æ‹¿ã€é¡å‹æ€éº¼è½‰ã€çµæœæ€éº¼è¿”å›ã€ç•°å¸¸æ€éº¼è™•ç†ã€é€™äº›æ‰æ˜¯ Spring MVC çœŸæ­£å¹«ä½ çœçš„äº‹ã€‚

  ä½ çš„ç›´è¦ºæ²’éŒ¯ï¼Œè·¯ç”±ä¸é›£ã€‚ä½† Spring æŠŠæ•´å€‹è«‹æ±‚ç”Ÿå‘½é€±æœŸéƒ½è‡ªå‹•åŒ–äº†ï¼Œé€™æ‰æ˜¯å®ƒçš„åƒ¹å€¼ã€‚



