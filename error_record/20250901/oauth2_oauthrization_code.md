

用户                系统B(客户端)             系统A(授权服务器)
|                        |                           |
| 点击"使用A账号登录"     |                           |
|----------------------->|                           |
|                        | 生成state，重定向用户     |
|                        |-------------------------->|
|                        |  GET /authorize?...       |
|                        |   &redirect_uri=/callback |
|                        |   &state=xyz123           |
|                        |                           |
|                        |<--------------------------|
|                        |  返回登录页面(若未登录)    |
| 输入账号/密码 ---------->                           |
|                        |-------------------------->|
|                        |   校验用户名密码           |
|                        |<--------------------------|
|                        |   登录成功，显示授权页面   |
| 在授权页面点击"同意" ---->                           |
|--------------------------------------------------->|
|                        |<--------------------------|
|                        | 302 Redirect 到           |
|                        | https://systemb.com/callback?
|                        |   code=abcde&state=xyz123 |
|                        |                           |
|                        | 校验state，一致则继续      |
|                        | 用code换取access_token    |
|                        |-------------------------->|
|                        |  POST /token              |
|                        |<--------------------------|
|                        |  返回 access_token        |
|                        |                           |
|                        | 获取用户信息，建立本地会话 |
|                        |-------------------------->|
|                        |<--------------------------|
|                        |  用户信息(profile等)      |
|                        |                           |
| 最终进入主页/业务页面   |                           |
|<-----------------------|                           |