åŸºäºå½“å‰ç›®å½•åˆ†æä¸€ä¸‹é¡¹ç›®

â— Bash(ls -la)
  â¿ Â total 52
     drwxr-xr-x 1 baiyingwaming 197121     0  8æœˆ 29 17:12 .
     drwxr-xr-x 1 baiyingwaming 197121     0  9æœˆ  1 15:27 ..
     â€¦ +8 lines (ctrl+r to expand)

â— Read(README.md)
  â¿ Â Read 88 lines (ctrl+r to expand)

â— Bash(find . -type f -name "*.md" -o -name "*.java" -o -name "*.yml" -o -name "*.yaml" -o -name "*.json" -o -name
      "pom.xml" | head -20)
  â¿ Â ./.claude/settings.local.json
     ./flowable-demo/debug_guide.md
     ./flowable-demo/FLOWABLE_API_TEST.md
     â€¦ +17 lines (ctrl+r to expand)

â— Read(flowable-demo\pom.xml)
  â¿ Â Read 119 lines (ctrl+r to expand)

â— Read(flowable-demo\src\main\resources\application.yml)
  â¿ Â Read 18 lines (ctrl+r to expand)

â— Bash(ls -la flowable-demo/src/main/java/com/example/flowabledemo/)
  â¿ Â total 5
     drwxr-xr-x 1 baiyingwaming 197121   0  9æœˆ  2 15:28 .
     drwxr-xr-x 1 baiyingwaming 197121   0  8æœˆ 19 16:44 ..
     -rw-r--r-- 1 baiyingwaming 197121 341  8æœˆ 29 10:32 FlowableDemoApplication.java

â— Bash(ls -la flowable-demo-ui/)
  â¿ Â total 61
     drwxr-xr-x 1 baiyingwaming 197121    0  8æœˆ 27 09:00 .
     drwxr-xr-x 1 baiyingwaming 197121    0  8æœˆ 29 17:12 ..
     â€¦ +8 lines (ctrl+r to expand)

â— åŸºäºå½“å‰ç›®å½•ç»“æ„çš„é¡¹ç›®åˆ†æï¼š

  é¡¹ç›®æ¦‚è§ˆ

  è¿™æ˜¯ä¸€ä¸ªèº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆæ¼”ç¤ºé¡¹ç›®ï¼Œæä¾›äº†OAuth2å’ŒOpenID Connect(OIDC)ä¸¤å¥—å®Œæ•´çš„èº«ä»½è®¤è¯æ–¹æ¡ˆã€‚

  é¡¹ç›®ç»“æ„

  æ ¸å¿ƒç»„ä»¶

  - oauth2-docs/ - OAuth2æˆæƒæ¡†æ¶è§£å†³æ–¹æ¡ˆæ–‡æ¡£
  - oidc-docs/ - OpenID Connectèº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆæ–‡æ¡£
  - flowable-demo/ - Spring Bootåç«¯æ¼”ç¤ºé¡¹ç›®
  - flowable-demo-ui/ - å‰ç«¯æ¼”ç¤ºç•Œé¢

  æŠ€æœ¯æ ˆ

  - åç«¯: Spring Boot 3.1.5 + Spring Security 6 + Flowable 7.0.0
  - æ•°æ®åº“: MySQL 8.0+
  - å‰ç«¯: HTML5 + JavaScript + CSS (çº¯å‰ç«¯)
  - æ„å»ºå·¥å…·: Maven 3.6+
  - Javaç‰ˆæœ¬: JDK 17

  é¡¹ç›®ç‰¹ç‚¹

  1. åŒé‡è®¤è¯æ–¹æ¡ˆ

  - OAuth2: ä¸“æ³¨èµ„æºæˆæƒï¼Œé€‚ç”¨äºAPIæˆæƒå’Œç¬¬ä¸‰æ–¹åº”ç”¨é›†æˆ
  - OIDC: èº«ä»½è®¤è¯+æˆæƒï¼Œæ”¯æŒSSOå’Œç”¨æˆ·èº«ä»½ç®¡ç†

  2. å®Œæ•´æ–‡æ¡£ä½“ç³»

  - åŸç†æ–‡æ¡£ï¼šç†è®ºåŸºç¡€ã€æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡
  - è§£å†³æ–¹æ¡ˆæ–‡æ¡£ï¼šæŠ€æœ¯å®ç°ã€ä»£ç ç¤ºä¾‹ã€é…ç½®æ–‡ä»¶

  3. å·¥ç¨‹åŒ–é…ç½®

  - Mavenå¤šé…ç½®æ„å»º(fat jar + thin jar)
  - ä¾èµ–ç®¡ç†å’Œå¤åˆ¶é…ç½®
  - å¼€å‘/ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»

  é¡¹ç›®çŠ¶æ€

  - åç«¯é¡¹ç›®ç»“æ„å®Œæ•´ï¼ŒåŸºäºFlowableå·¥ä½œæµå¼•æ“
  - å‰ç«¯é‡‡ç”¨è½»é‡çº§å®ç°ï¼ŒåŒ…å«æœåŠ¡å™¨è„šæœ¬
  - æ–‡æ¡£é½å…¨ï¼ŒåŒ…å«å‹ç¼©åŒ…å¤‡ä»½
  - æœªåˆå§‹åŒ–Gitä»“åº“

  è¿™æ˜¯ä¸€ä¸ªæ•™å­¦/æ¼”ç¤ºæ€§è´¨çš„èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆé¡¹ç›®ï¼Œé€‚åˆå­¦ä¹ OAuth2/OIDCåè®®å®ç°å’ŒSpring Securityé›†æˆã€‚

> oauth2çš„æ–‡æ¡£ç›®å‰æ˜¯ä¸¤ä¸ªï¼Œå¯ä»¥ç»™æˆ‘åˆ†æˆä¸‰ä¸ªå—ï¼Ÿ
  ç¬¬ä¸€ä¸ªæ˜¯ä»‹ç»oauth2çš„è¯ç”ŸèƒŒæ™¯å†å²ï¼Œå‘å±•ï¼Œä»¥åŠç°çŠ¶ï¼›
  ç¬¬äºŒä¸ªæ˜¯è®²è¿°oauth2çš„åŸç†ï¼›
  ç¬¬ä¸‰ä¸ªæ˜¯oauth2çš„å®ç°ï¼ŒåŸºäºoauth2çš„åŸç†ï¼Œç”¨javaï¼Œspringbootå’Œå‰ç«¯reactæ¡†æ¶çš„å®ç°ï¼Œç”¨æœ€ç®€å•çš„å®ç°åŠŸèƒ½å³å¯ï¼›
  æ ¸å¿ƒæ˜¯æŠŠåŸç†å’Œ åŸºäºjavaï¼Œspringbootï¼Œreactè¿™ä¸­é—´çš„å…³è”è®²è¿°æ¸…æ¥šï¼›

â— Read(oauth2-docs\OAuth2_Solution.md)
  â¿ Â Read 448 lines (ctrl+r to expand)

â— Read(oauth2-docs\OAuth2_Principles_and_Implementation.md)
  â¿ Â Read 615 lines (ctrl+r to expand)

â— Write(oauth2-docs\OAuth2_Background_and_History.md)
  â¿ Â Wrote 1 lines to oauth2-docs\OAuth2_Background_and_History.md
     # OAuth2 è¯ç”ŸèƒŒæ™¯ä¸å‘å±•å†å²
     ## 1. OAuth2 è¯ç”ŸèƒŒæ™¯
     ### 1.1 æ—¶ä»£èƒŒæ™¯ï¼ˆ2005-2010å¹´ï¼‰
     **Web 2.0æ—¶ä»£çš„å…´èµ·**
     - 2005å¹´å‰åï¼Œäº’è”ç½‘ä»é™æ€å†…å®¹å±•ç¤ºè½¬å‘ç”¨æˆ·ç”Ÿæˆå†…å®¹
     - ç¤¾äº¤åª’ä½“å¹³å°å¿«é€Ÿå‘å±•ï¼šFacebookï¼ˆ2004ï¼‰ã€Twitterï¼ˆ2006ï¼‰ã€LinkedInï¼ˆ2003ï¼‰
     - ç”¨æˆ·å¼€å§‹åœ¨å¤šä¸ªå¹³å°ä¸Šåˆ›å»ºå’Œåˆ†äº«å†…å®¹

â— Write(oauth2-docs\OAuth2_Principles.md)
  â¿ Â Wrote 1 lines to oauth2-docs\OAuth2_Principles.md
     # OAuth2 æ ¸å¿ƒåŸç†
     ## 1. OAuth2 åŸºç¡€æ¦‚å¿µ
     ### 1.1 OAuth2 çš„å®šä¹‰
     OAuth2ï¼ˆOpen Authorization 2.0ï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†çš„æˆæƒæ¡†æ¶ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºè·å¾—å¯¹HTTPæœåŠ¡ä¸Šç”¨æˆ·è´¦æˆ·çš„æœ‰é™è®¿é—®æƒã€‚OA
     uth2é€šè¿‡å°†ç”¨æˆ·è®¤è¯å§”æ‰˜ç»™æ‰˜ç®¡ç”¨æˆ·è´¦æˆ·çš„æœåŠ¡ï¼Œå¹¶æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®è¯¥ç”¨æˆ·è´¦æˆ·æ¥å·¥ä½œã€‚
     **æ ¸å¿ƒæ€æƒ³**ï¼šåˆ†ç¦»è®¤è¯ï¼ˆAuthenticationï¼‰å’Œæˆæƒï¼ˆAuthorizationï¼‰
     - **è®¤è¯**ï¼šéªŒè¯ç”¨æˆ·æ˜¯è°ï¼ˆWho are you?ï¼‰
     - **æˆæƒ**ï¼šç¡®å®šç”¨æˆ·å¯ä»¥åšä»€ä¹ˆï¼ˆWhat can you do?ï¼‰

â— Write(oauth2-docs\OAuth2_Implementation_Guide.md)
  â¿ Â Wrote 1 lines to oauth2-docs\OAuth2_Implementation_Guide.md
     # OAuth2 å®ç°æŒ‡å—ï¼šJava + Spring Boot + React
     ## 1. å®ç°æ¶æ„æ¦‚è¿°
     ### 1.1 æ¶æ„å›¾
     ```
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTPè¯·æ±‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Reactå‰ç«¯åº”ç”¨   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Spring Boot     â”‚
     â”‚  (OAuth2å®¢æˆ·ç«¯) â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ æˆæƒæœåŠ¡å™¨       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    é‡å®šå‘/ä»¤ç‰Œ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â— Update(README.md)
  â¿ Â Updated README.md with 10 additions and 7 removals
        3    æœ¬é¡¹ç›®æä¾›äº†ä¸¤å¥—å®Œæ•´çš„èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆï¼šOAuth2 å’Œ OpenID Connect (OIDC)ã€‚
        4
        5    ## ç›®å½•ç»“æ„
        6 -  [OAuth2_Solution.md](oauth2-docs/OAuth2_Solution.md)
        6 +
        7    ```
        8    demo/
        9 -  â”œâ”€â”€ oauth2-docs/           # OAuth2 æˆæƒæ¡†æ¶è§£å†³æ–¹æ¡ˆ
       10 -  â”‚   â”œâ”€â”€ OAuth2_Solution.md[OAuth[OAuth2_Solution.md](oauth2-docs/OAuth2_Solution.md)2_Principles_and_
          - Implementation.md](oauth2-docs/OAuth2_Principles_and_Implementation.md)
       11 -  â”‚   â””â”€â”€ OAuth2_Principles_and_Implementation.md
       12 -  â”œâ”€â”€ oidc-docs/            # OpenID Connect èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆ
        9 +  â”œâ”€â”€ oauth2-docs/                              # OAuth2 æˆæƒæ¡†æ¶æ–‡æ¡£
       10 +  â”‚   â”œâ”€â”€ OAuth2_Background_and_History.md      # OAuth2è¯ç”ŸèƒŒæ™¯ä¸å‘å±•å†å²
       11 +  â”‚   â”œâ”€â”€ OAuth2_Principles.md                  # OAuth2æ ¸å¿ƒåŸç†
       12 +  â”‚   â”œâ”€â”€ OAuth2_Implementation_Guide.md        # OAuth2å®ç°æŒ‡å—(Java+Spring Boot+React)
       13 +  â”‚   â”œâ”€â”€ OAuth2_Solution.md                    # OAuth2è§£å†³æ–¹æ¡ˆ(åŸæœ‰æ–‡æ¡£)
       14 +  â”‚   â””â”€â”€ OAuth2_Principles_and_Implementation.md # OAuth2åŸç†ä¸å®ç°(åŸæœ‰æ–‡æ¡£)
       15 +  â”œâ”€â”€ oidc-docs/                                # OpenID Connect èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆ
       16    â”‚   â”œâ”€â”€ OIDC_Solution.md
       17    â”‚   â””â”€â”€ OIDC_Principles_and_Implementation.md
       18 -  â”œâ”€â”€ flowable-demo/        # Spring Boot æ¼”ç¤ºé¡¹ç›®
       19 -  â””â”€â”€ flowable-demo-ui/     # å‰ç«¯æ¼”ç¤ºç•Œé¢
       18 +  â”œâ”€â”€ flowable-demo/                            # Spring Boot æ¼”ç¤ºé¡¹ç›®
       19 +  â””â”€â”€ flowable-demo-ui/                         # å‰ç«¯æ¼”ç¤ºç•Œé¢
       20    ```
       21
       22    ## æ–¹æ¡ˆé€‰æ‹©æŒ‡å—

â— Update(README.md)
  â¿ Â Updated README.md with 25 additions and 7 removals
       39    - **ä»¤ç‰Œ**: JWTæ ¼å¼
       40    - **åè®®**: OAuth 2.0 / OpenID Connect 1.0
       41
       42 -  ## å¿«é€Ÿå¼€å§‹
       42 +  ## OAuth2 å­¦ä¹ è·¯å¾„
       43
       44 -  1. **æŸ¥çœ‹åŸç†æ–‡æ¡£**
       45 -     - OAuth2: `oauth2-docs/OAuth2_Principles_and_Implementation.md`
       46 -     - OIDC: `oidc-docs/OIDC_Principles_and_Implementation.md`
       44 +  æ¨èæŒ‰ä»¥ä¸‹é¡ºåºé˜…è¯»OAuth2æ–‡æ¡£ï¼Œé€æ­¥æ·±å…¥ç†è§£ï¼š
       45
       46 -  2. **æŸ¥çœ‹å®ç°æ–¹æ¡ˆ**
       47 -     - OAuth2: `oauth2-docs/OAuth2_Solution.md`
       48 -     - OIDC: `oidc-docs/OIDC_Solution.md`
       46 +  ### ç¬¬ä¸€é˜¶æ®µï¼šäº†è§£èƒŒæ™¯
       47 +  - ğŸ“š [OAuth2è¯ç”ŸèƒŒæ™¯ä¸å‘å±•å†å²](oauth2-docs/OAuth2_Background_and_History.md)
       48 +    - ä¸ºä»€ä¹ˆéœ€è¦OAuth2ï¼Ÿ
       49 +    - OAuth2æ˜¯å¦‚ä½•å‘å±•æ¥çš„ï¼Ÿ
       50 +    - å½“å‰åº”ç”¨ç°çŠ¶å’Œæœªæ¥è¶‹åŠ¿
       51
       52 +  ### ç¬¬äºŒé˜¶æ®µï¼šæŒæ¡åŸç†
       53 +  - ğŸ” [OAuth2æ ¸å¿ƒåŸç†](oauth2-docs/OAuth2_Principles.md)
       54 +    - å››ä¸ªæ ¸å¿ƒè§’è‰²è¯¦è§£
       55 +    - æˆæƒç æµç¨‹åŸç†
       56 +    - ä»¤ç‰Œç±»å‹å’Œç”Ÿå‘½å‘¨æœŸ
       57 +    - ä½œç”¨åŸŸå’Œæƒé™æ§åˆ¶
       58 +
       59 +  ### ç¬¬ä¸‰é˜¶æ®µï¼šåŠ¨æ‰‹å®è·µ
       60 +  - ğŸ’» [OAuth2å®ç°æŒ‡å—](oauth2-docs/OAuth2_Implementation_Guide.md)
       61 +    - Java + Spring Boot + Reactå®Œæ•´å®ç°
       62 +    - åŸç†åˆ°ä»£ç çš„æ˜ å°„å…³ç³»
       63 +    - æ ¸å¿ƒç»„ä»¶å’Œé…ç½®è¯¦è§£
       64 +    - å®Œæ•´æµç¨‹æ¼”ç¤º
       65 +
       66 +  ## å¿«é€Ÿå¼€å§‹
       67 +
       68 +  ### OAuth2æ–¹æ¡ˆ
       69 +
       70    3. **ç¯å¢ƒå‡†å¤‡**
       71       - Java 17+
       72       - MySQL 8.0+

â— Update(README.md)
  â¿ Â Updated README.md with 8 additions and 2 removals
       65
       66    ## å¿«é€Ÿå¼€å§‹
       67
       68 -  ### OAuth2æ–¹æ¡ˆ
       68 +  ### OIDCæ–¹æ¡ˆ
       69
       70 -  3. **ç¯å¢ƒå‡†å¤‡**
       70 +  1. **æŸ¥çœ‹åŸç†æ–‡æ¡£**
       71 +     - OIDC: `oidc-docs/OIDC_Principles_and_Implementation.md`
       72 +
       73 +  2. **æŸ¥çœ‹å®ç°æ–¹æ¡ˆ**
       74 +     - OIDC: `oidc-docs/OIDC_Solution.md`
       75 +
       76 +  ## ç¯å¢ƒå‡†å¤‡
       77       - Java 17+
       78       - MySQL 8.0+
       79       - Maven 3.6+

â— Update(README.md)
  â¿ Â Updated README.md with 5 additions and 4 removals
       74       - OIDC: `oidc-docs/OIDC_Solution.md`
       75
       76    ## ç¯å¢ƒå‡†å¤‡
       77 -     - Java 17+
       78 -     - MySQL 8.0+
       79 -     - Maven 3.6+
       77 +  - Java 17+
       78 +  - MySQL 8.0+
       79 +  - Maven 3.6+
       80 +  - Node.js 16+ (å¦‚æœè¦è¿è¡ŒReactå‰ç«¯)
       81
       82 -  4. **æ•°æ®åº“åˆå§‹åŒ–**
       82 +  ## æ•°æ®åº“åˆå§‹åŒ–
       83       - åˆ›å»ºæ•°æ®åº“: `oidc_demo` æˆ– `oauth2_demo`
       84       - è¿è¡Œå¯¹åº”æ–¹æ¡ˆä¸­çš„SQLè„šæœ¬
       85

â— Update(README.md)
  â¿ Â Updated README.md with 3 additions and 4 removals
       79    - Maven 3.6+
       80    - Node.js 16+ (å¦‚æœè¦è¿è¡ŒReactå‰ç«¯)
       81
       82 -  ## æ•°æ®åº“åˆå§‹åŒ–
       83 -     - åˆ›å»ºæ•°æ®åº“: `oidc_demo` æˆ– `oauth2_demo`
       84 -     - è¿è¡Œå¯¹åº”æ–¹æ¡ˆä¸­çš„SQLè„šæœ¬
       82 +  - åˆ›å»ºæ•°æ®åº“: `oidc_demo` æˆ– `oauth2_demo`
       83 +  - è¿è¡Œå¯¹åº”æ–¹æ¡ˆä¸­çš„SQLè„šæœ¬
       84
       85 -  5. **å¯åŠ¨é¡¹ç›®**
       85 +  ## å¯åŠ¨é¡¹ç›®
       86       - ä¿®æ”¹ `application.yml` ä¸­çš„æ•°æ®åº“é…ç½®
       87       - è¿è¡Œ `mvn spring-boot:run`
       88

â— Update(README.md)
  â¿ Â Updated README.md with 3 additions and 3 removals
       82    - åˆ›å»ºæ•°æ®åº“: `oidc_demo` æˆ– `oauth2_demo`
       83    - è¿è¡Œå¯¹åº”æ–¹æ¡ˆä¸­çš„SQLè„šæœ¬
       84
       85 -  ## å¯åŠ¨é¡¹ç›®
       86 -     - ä¿®æ”¹ `application.yml` ä¸­çš„æ•°æ®åº“é…ç½®
       87 -     - è¿è¡Œ `mvn spring-boot:run`
       85 +  - ä¿®æ”¹ `application.yml` ä¸­çš„æ•°æ®åº“é…ç½®
       86 +  - è¿è¡Œ `mvn spring-boot:run`
       87 +  - (å¯é€‰) å¯åŠ¨Reactå‰ç«¯: `cd flowable-demo-ui && npm start`
       88
       89    ## æ–‡æ¡£è¯´æ˜
       90

â— Update(README.md)
  â¿ Â Updated README.md with 14 additions and 5 removals
        86    - è¿è¡Œ `mvn spring-boot:run`
        87    - (å¯é€‰) å¯åŠ¨Reactå‰ç«¯: `cd flowable-demo-ui && npm start`
        88
        89 -  ## æ–‡æ¡£è¯´æ˜
        89 +  ## æ–‡æ¡£ç‰¹è‰²
        90
        91 -  ### åŸç†æ–‡æ¡£
        92 -  åŒ…å«å®Œæ•´çš„ç†è®ºåŸºç¡€ã€å†å²èƒŒæ™¯ã€æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡å’Œå®æ–½æ­¥éª¤è¯´æ˜ã€‚
        91 +  ### ğŸ“– åˆ†å±‚é€’è¿›çš„å­¦ä¹ ä½“ç³»
        92 +  - **èƒŒæ™¯ç¯‡**: äº†è§£OAuth2çš„æ¥é¾™å»è„‰
        93 +  - **åŸç†ç¯‡**: æ·±å…¥ç†è§£æ ¸å¿ƒæœºåˆ¶
        94 +  - **å®è·µç¯‡**: å®Œæ•´çš„ä»£ç å®ç°
        95
        96 -  ### è§£å†³æ–¹æ¡ˆæ–‡æ¡£
        97 -  åŒ…å«å…·ä½“çš„æŠ€æœ¯å®ç°ã€ä»£ç ç¤ºä¾‹ã€é…ç½®æ–‡ä»¶ã€æ•°æ®åº“è®¾è®¡ç­‰å®æ–½ç»†èŠ‚ã€‚
        96 +  ### ğŸ”— ç†è®ºä¸å®è·µå®Œç¾ç»“åˆ
        97 +  - æ¯ä¸ªåŸç†æ¦‚å¿µéƒ½æœ‰å¯¹åº”çš„ä»£ç å®ç°
        98 +  - è¯¦ç»†çš„åŸç†åˆ°ä»£ç çš„æ˜ å°„è¯´æ˜
        99 +  - å®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹é¡¹ç›®
       100
       101 +  ### ğŸ’¡ æœ€ä½³å®è·µå’Œå®‰å…¨è€ƒè™‘
       102 +  - ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®
       103 +  - å®‰å…¨æœºåˆ¶è¯¦ç»†è¯´æ˜
       104 +  - æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§æŒ‡å¯¼
       105 +
       106    ## ç‰¹æ€§å¯¹æ¯”
       107
       108    | ç‰¹æ€§ | OAuth2 | OIDC |

â— å·²æˆåŠŸå°†OAuth2æ–‡æ¡£é‡æ–°ç»„ç»‡ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„æ–‡æ¡£ï¼š

  ğŸ“ æ–°çš„æ–‡æ¡£ç»“æ„

  1. OAuth2è¯ç”ŸèƒŒæ™¯ä¸å‘å±•å†å²

  oauth2-docs/OAuth2_Background_and_History.md
  - OAuth2çš„è¯ç”ŸèƒŒæ™¯å’Œæ—¶ä»£éœ€æ±‚
  - OAuth 1.0åˆ°OAuth 2.1çš„å®Œæ•´å‘å±•å†ç¨‹
  - è§£å†³çš„æ ¸å¿ƒé—®é¢˜å’ŒæŠ€æœ¯ä»·å€¼
  - å½“å‰åº”ç”¨ç°çŠ¶å’Œæœªæ¥è¶‹åŠ¿

  2. OAuth2æ ¸å¿ƒåŸç†

  oauth2-docs/OAuth2_Principles.md
  - å››ä¸ªæ ¸å¿ƒè§’è‰²è¯¦ç»†è§£æ
  - æˆæƒç æµç¨‹çš„æ¯ä¸ªæ­¥éª¤åŸç†
  - ä»¤ç‰Œç±»å‹å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
  - ä½œç”¨åŸŸæƒé™æ§åˆ¶æœºåˆ¶
  - å®‰å…¨è€ƒè™‘å’Œæœ€ä½³å®è·µ

  3. OAuth2å®ç°æŒ‡å—

  oauth2-docs/OAuth2_Implementation_Guide.md
  - å®Œæ•´çš„Java + Spring Boot + Reactå®ç°
  - åŸç†æ¦‚å¿µåˆ°å…·ä½“ä»£ç çš„æ˜ å°„å…³ç³»
  - æ•°æ®åº“è®¾è®¡å’Œæ ¸å¿ƒé…ç½®è¯¦è§£
  - å®Œæ•´çš„OAuth2æµç¨‹æ¼”ç¤º
  - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è€ƒè™‘

  ğŸ¯ æ ¸å¿ƒç‰¹è‰²

  åˆ†å±‚é€’è¿›å­¦ä¹ ï¼šæŒ‰ç…§èƒŒæ™¯â†’åŸç†â†’å®è·µçš„è·¯å¾„ï¼Œå¾ªåºæ¸è¿›ç†è§£OAuth2

  ç†è®ºå®è·µç»“åˆï¼šæ¯ä¸ªåŸç†æ¦‚å¿µéƒ½æœ‰å¯¹åº”çš„å…·ä½“ä»£ç å®ç°ï¼ŒçœŸæ­£åšåˆ°çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶

  å®Œæ•´å¯è¿è¡Œï¼šæä¾›äº†å®Œæ•´çš„Spring Bootåç«¯å’ŒReactå‰ç«¯å®ç°ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œä½“éªŒOAuth2æµç¨‹

  æ–‡æ¡£å·²æŒ‰æ‚¨çš„è¦æ±‚é‡æ–°ç»„ç»‡ï¼Œç°åœ¨å¯ä»¥æ›´å¥½åœ°å¸®åŠ©è¯»è€…ä»OAuth2çš„å†å²èƒŒæ™¯å¼€å§‹ï¼Œé€æ­¥æ·±å…¥ç†è§£åŸç†ï¼Œæœ€åé€šè¿‡å…·ä½“çš„Javaå’ŒReact
  ä»£ç å®ç°æ¥æŒæ¡OAuth2çš„å®é™…åº”ç”¨ã€‚

> å…³äºæˆæƒæµç¨‹çš„å…«ä¸ªæ­¥éª¤ï¼š
  1.è®¿é—®åº”ç”¨
  2.æ„å»ºæˆæƒURLå¹¶é‡å®šå‘ç”¨æˆ·
  3.ç”¨æˆ·åœ¨æˆæƒæœåŠ¡å™¨é¡µé¢ç™»å½•å¹¶æˆæƒ
  4.é‡å®šå‘å›å®¢æˆ·ç«¯æºå¸¦æˆæƒç 
  5.ç”¨æˆæƒç +å®¢æˆ·ç«¯å‡­è¯æ¢å–ä»¤ç‰Œ
  6.è¿”å›è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ
  7.ä½¿ç”¨è®¿é—®ä»¤ç‰Œè®¿é—®API
  8.éªŒè¯ä»¤ç‰Œå¹¶è¿”å›å—ä¿æŠ¤èµ„æº

  ä¸ºä»€ä¹ˆä¸åœ¨ç¬¬ä¸‰æ­¥æˆæƒåç›´æ¥ç»™ä»¤ç‰Œï¼Œè®©å®¢æˆ·ç«¯ç›´æ¥è®¿é—®èµ„æºå‘¢ï¼Ÿ
  è¿˜å¤šäº†4ï¼Œ5ä¸¤ä¸ªæ­¥éª¤å‘¢ï¼Ÿ

â— è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼è¿™æ­£æ˜¯OAuth2è®¾è®¡çš„ç²¾å¦™ä¹‹å¤„ã€‚è®©æˆ‘è¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆä¸èƒ½åœ¨ç¬¬3æ­¥ç›´æ¥è¿”å›ä»¤ç‰Œï¼š

  ğŸš¨ ç›´æ¥è¿”å›ä»¤ç‰Œçš„å®‰å…¨é£é™©

  1. å‰ç«¯é€šé“ä¸å®‰å…¨

  ç¬¬3æ­¥çš„é‡å®šå‘å‘ç”Ÿåœ¨æµè§ˆå™¨åœ°å€æ ï¼š
  âŒ å±é™©æ–¹å¼ï¼š
  https://client.com/callback?access_token=eyJhbGciOiJSUzI1NiJ9...

  é—®é¢˜ï¼š
  - ä»¤ç‰Œæš´éœ²åœ¨æµè§ˆå™¨åœ°å€æ 
  - æµè§ˆå™¨å†å²è®°å½•ä¼šä¿å­˜ä»¤ç‰Œ
  - æœåŠ¡å™¨è®¿é—®æ—¥å¿—ä¼šè®°å½•ä»¤ç‰Œ
  - ç”¨æˆ·å¯èƒ½æ— æ„ä¸­åˆ†äº«å¸¦ä»¤ç‰Œçš„URL

  2. æ— æ³•éªŒè¯å®¢æˆ·ç«¯èº«ä»½

  ç¬¬3æ­¥åªæ¶‰åŠç”¨æˆ·å’ŒæˆæƒæœåŠ¡å™¨ï¼š
  ç”¨æˆ· â†’ æˆæƒæœåŠ¡å™¨ â†’ æµè§ˆå™¨é‡å®šå‘

  æ­¤æ—¶æˆæƒæœåŠ¡å™¨æ— æ³•ç¡®è®¤ï¼š
  - æ¥æ”¶ä»¤ç‰Œçš„çœŸçš„æ˜¯åˆæ³•å®¢æˆ·ç«¯å—ï¼Ÿ
  - è¿˜æ˜¯è¢«æ¶æ„ç½‘ç«™æ‹¦æˆªäº†ï¼Ÿ

  âœ… æˆæƒç æµç¨‹çš„å®‰å…¨ä¼˜åŠ¿

  æ­¥éª¤4ï¼šæˆæƒç çš„å®‰å…¨è®¾è®¡

  æˆæƒç ç‰¹ç‚¹ï¼š
  - ä¸€æ¬¡æ€§ä½¿ç”¨ï¼ˆç”¨å®Œå³åºŸï¼‰
  - çŸ­æœŸæœ‰æ•ˆï¼ˆé€šå¸¸10åˆ†é’Ÿï¼‰
  - å³ä½¿è¢«æ‹¦æˆªä¹Ÿæ— æ³•ç›´æ¥è®¿é—®èµ„æº
  - å¿…é¡»é…åˆå®¢æˆ·ç«¯å¯†é’¥æ‰èƒ½æ¢å–ä»¤ç‰Œ

  æ­¥éª¤5ï¼šåç«¯é€šé“çš„å®‰å…¨ä¿éšœ

  // è¿™ä¸ªè¯·æ±‚å‘ç”Ÿåœ¨å®¢æˆ·ç«¯æœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨ä¹‹é—´
  // ä¸ç»è¿‡æµè§ˆå™¨ï¼Œæ›´åŠ å®‰å…¨
  POST /oauth2/token HTTP/1.1
  Host: auth-server.com
  Content-Type: application/x-www-form-urlencoded
  Authorization: Basic base64(client_id:client_secret)  // å®¢æˆ·ç«¯èº«ä»½è®¤è¯

  grant_type=authorization_code&
  code=SplxlOBeZQQYbYS6WxSbIA&          // æˆæƒç 
  redirect_uri=https://client.com/callback&
  client_id=my-client

  å…³é”®å®‰å…¨æœºåˆ¶ï¼š
  1. å®¢æˆ·ç«¯è®¤è¯ï¼šå¿…é¡»æä¾›client_secretè¯æ˜èº«ä»½
  2. åç«¯é€šé“ï¼šä»¤ç‰Œé€šè¿‡æœåŠ¡å™¨é—´HTTPSä¼ è¾“ï¼Œä¸ç»è¿‡æµè§ˆå™¨
  3. æˆæƒç éªŒè¯ï¼šç¡®ä¿æˆæƒç æ˜¯åˆæ³•è·å¾—çš„

  ğŸ” å…·ä½“æ”»å‡»åœºæ™¯å¯¹æ¯”

  å¦‚æœç¬¬3æ­¥ç›´æ¥è¿”å›ä»¤ç‰Œï¼š

  æ”»å‡»åœºæ™¯ï¼šæ¶æ„ç½‘ç«™ä»¤ç‰Œçªƒå–
  1. ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™ evil.com
  2. evil.comé‡å®šå‘ç”¨æˆ·åˆ°æ­£å¸¸çš„æˆæƒæœåŠ¡å™¨
  3. ç”¨æˆ·æ­£å¸¸ç™»å½•å¹¶æˆæƒ
  4. æˆæƒæœåŠ¡å™¨é‡å®šå‘ï¼ševil.com/callback?access_token=...
  5. æ¶æ„ç½‘ç«™è·å¾—ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼

  æˆæƒç æµç¨‹çš„é˜²æŠ¤ï¼š

  åŒæ ·æ”»å‡»åœºæ™¯ä¸‹ï¼š
  1-3æ­¥ç›¸åŒ
  4. æˆæƒæœåŠ¡å™¨é‡å®šå‘ï¼ševil.com/callback?code=abc123
  5. evil.comå°è¯•ç”¨æˆæƒç æ¢ä»¤ç‰Œï¼š
     POST /oauth2/token
     code=abc123&client_id=evil-client&client_secret=???

  ç»“æœï¼šå¤±è´¥ï¼å› ä¸ºevil.comæ²¡æœ‰æ­£ç¡®çš„client_secret

  ğŸ“Š ä¸¤ç§æ–¹å¼å¯¹æ¯”è¡¨

  | å®‰å…¨æ–¹é¢    | ç›´æ¥è¿”å›ä»¤ç‰Œ      | æˆæƒç æµç¨‹               |
  |---------|-------------|---------------------|
  | ä»¤ç‰Œæš´éœ²é£é™©  | âŒ é«˜ï¼ˆæµè§ˆå™¨åœ°å€æ ï¼‰ | âœ… ä½ï¼ˆåç«¯é€šé“ï¼‰           |
  | å®¢æˆ·ç«¯éªŒè¯   | âŒ æ— æ³•éªŒè¯      | âœ… é€šè¿‡client_secretéªŒè¯ |
  | ä»¤ç‰Œæ‹¦æˆªåæœ  | âŒ ç›´æ¥å¯ç”¨      | âœ… æ— æ³•ä½¿ç”¨ï¼ˆéœ€è¦å¯†é’¥ï¼‰        |
  | æµè§ˆå™¨å†å²è®°å½• | âŒ åŒ…å«ä»¤ç‰Œ      | âœ… åªåŒ…å«æ— ç”¨çš„æˆæƒç          |
  | æ—¥å¿—æ³„éœ²é£é™©  | âŒ é«˜         | âœ… ä½                 |

  ğŸ›ï¸ OAuth2è®¾è®¡å“²å­¦

  è¿™ä½“ç°äº†OAuth2çš„æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š

  ä¿¡ä»»è¾¹ç•Œåˆ†ç¦»

  å‰ç«¯é€šé“ï¼ˆä¸å¯ä¿¡ï¼‰ï¼š
  - æµè§ˆå™¨é‡å®šå‘
  - ç”¨æˆ·å¯è§çš„URL
  - åªä¼ è¾“ä¸´æ—¶çš„æˆæƒç 

  åç«¯é€šé“ï¼ˆå¯ä¿¡ï¼‰ï¼š
  - æœåŠ¡å™¨é—´HTTPSé€šä¿¡
  - ä¼ è¾“æ•æ„Ÿçš„è®¿é—®ä»¤ç‰Œ
  - è¿›è¡Œå®¢æˆ·ç«¯èº«ä»½éªŒè¯

  æœ€å°æƒé™åŸåˆ™

  æˆæƒç çš„èƒ½åŠ›ï¼š
  - åªèƒ½æ¢å–ä»¤ç‰Œï¼Œä¸èƒ½ç›´æ¥è®¿é—®èµ„æº
  - ä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œç”¨å®Œå³åºŸ
  - çŸ­æœŸæœ‰æ•ˆï¼Œé™ä½é£é™©çª—å£

  è®¿é—®ä»¤ç‰Œçš„è·å–ï¼š
  - éœ€è¦å¤šé‡éªŒè¯ï¼ˆæˆæƒç  + å®¢æˆ·ç«¯å¯†é’¥ï¼‰
  - é€šè¿‡å®‰å…¨é€šé“ä¼ è¾“
  - å¯ä»¥åŒ…å«ä¸°å¯Œçš„æƒé™ä¿¡æ¯

  ğŸ’¡ ç°å®ç±»æ¯”

  å°±åƒé“¶è¡Œå–æ¬¾ï¼š

  ä¸å®‰å…¨çš„æ–¹å¼ï¼ˆç›´æ¥ç»™ä»¤ç‰Œï¼‰ï¼š
  ä½ å»ATM â†’ è¾“å…¥å¯†ç  â†’ ATMç›´æ¥åå‡ºç°é‡‘åˆ°åœ°ä¸Š
  ä»»ä½•äººéƒ½èƒ½çœ‹åˆ°å’Œæ‹¿èµ°ç°é‡‘

  å®‰å…¨çš„æ–¹å¼ï¼ˆæˆæƒç æµç¨‹ï¼‰ï¼š
  ä½ å»ATM â†’ è¾“å…¥å¯†ç  â†’ ATMç»™ä½ ä¸€ä¸ªæå–ç 
  ä½ æ‹¿ç€æå–ç  + èº«ä»½è¯ â†’ åˆ°é“¶è¡ŒæŸœå° â†’ éªŒè¯èº«ä»½åç»™ç°é‡‘
  å³ä½¿åˆ«äººçœ‹åˆ°æå–ç ï¼Œæ²¡æœ‰èº«ä»½è¯ä¹Ÿæ‹¿ä¸åˆ°é’±

  è¿™å°±æ˜¯ä¸ºä»€ä¹ˆOAuth2è¦è®¾è®¡æˆä¸¤é˜¶æ®µéªŒè¯ï¼šå…ˆè·å¾—æˆæƒè®¸å¯ï¼ˆæˆæƒç ï¼‰ï¼Œå†é€šè¿‡å®‰å…¨é€šé“å…‘æ¢å®é™…çš„è®¿é—®å‡­è¯ï¼ˆä»¤ç‰Œï¼‰ã€‚è¿™4ã€5ä¸¤
  ä¸ªæ­¥éª¤çœ‹ä¼¼å¤šä½™ï¼Œå®é™…ä¸Šæ˜¯æ•´ä¸ªå®‰å…¨æ¶æ„çš„å…³é”®ï¼

> æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæˆæƒæœåŠ¡å™¨æ˜¯åœ¨éªŒè¯ç”¨æˆ·ï¼Œè¿˜æ˜¯å†éªŒè¯å®¢æˆ·ç«¯ï¼Ÿ

â— è¿™æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„é—®é¢˜ï¼ç­”æ¡ˆæ˜¯ï¼šæˆæƒæœåŠ¡å™¨æ—¢è¦éªŒè¯ç”¨æˆ·ï¼Œä¹Ÿè¦éªŒè¯å®¢æˆ·ç«¯ï¼Œä½†åœ¨ä¸åŒçš„é˜¶æ®µè¿›è¡Œã€‚

  ğŸ” æˆæƒæœåŠ¡å™¨çš„åŒé‡éªŒè¯è´£ä»»

  ç¬¬ä¸€é‡éªŒè¯ï¼šç”¨æˆ·èº«ä»½éªŒè¯ï¼ˆæ­¥éª¤3ï¼‰

  ç”¨æˆ·è®¿é—®æˆæƒé¡µé¢æ—¶ï¼š
  GET /oauth2/authorize?client_id=react-client&...

  æˆæƒæœåŠ¡å™¨éªŒè¯ï¼š
  âœ… è¿™ä¸ªç”¨æˆ·æ˜¯è°ï¼Ÿï¼ˆç”¨æˆ·åå¯†ç ï¼‰
  âœ… ç”¨æˆ·æ˜¯å¦æœ‰æ•ˆï¼Ÿï¼ˆè´¦æˆ·çŠ¶æ€ï¼‰
  âœ… ç”¨æˆ·æ˜¯å¦åŒæ„æˆæƒï¼Ÿï¼ˆæƒé™ç¡®è®¤ï¼‰

  ç¬¬äºŒé‡éªŒè¯ï¼šå®¢æˆ·ç«¯èº«ä»½éªŒè¯ï¼ˆæ­¥éª¤5ï¼‰

  å®¢æˆ·ç«¯ç”¨æˆæƒç æ¢ä»¤ç‰Œæ—¶ï¼š
  POST /oauth2/token
  Authorization: Basic base64(client_id:client_secret)
  Body: grant_type=authorization_code&code=...

  æˆæƒæœåŠ¡å™¨éªŒè¯ï¼š
  âœ… è¿™ä¸ªå®¢æˆ·ç«¯æ˜¯è°ï¼Ÿï¼ˆclient_idï¼‰
  âœ… å®¢æˆ·ç«¯å‡­è¯æ˜¯å¦æ­£ç¡®ï¼Ÿï¼ˆclient_secretï¼‰
  âœ… å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™ï¼Ÿï¼ˆæ³¨å†Œä¿¡æ¯ï¼‰
  âœ… æˆæƒç æ˜¯å¦åŒ¹é…ï¼Ÿï¼ˆæ˜¯å¦æ˜¯ç»™è¿™ä¸ªå®¢æˆ·ç«¯çš„ï¼‰

  ğŸ“Š éªŒè¯æ—¶åºå›¾

  ç”¨æˆ·    å®¢æˆ·ç«¯    æˆæƒæœåŠ¡å™¨
  â”‚        â”‚          â”‚
  â”‚ 1.è®¿é—®åº”ç”¨         â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚
  â”‚        â”‚          â”‚
  â”‚        â”‚ 2.é‡å®šå‘åˆ°æˆæƒé¡µé¢
  â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚        â”‚          â”‚
  â”‚ 3.ã€éªŒè¯ç”¨æˆ·èº«ä»½ã€‘   â”‚  â† ç¬¬ä¸€é‡éªŒè¯
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚        â”‚          â”‚
  â”‚        â”‚ 4.è¿”å›æˆæƒç â”‚
  â”‚        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚        â”‚          â”‚
  â”‚        â”‚ 5.ã€éªŒè¯å®¢æˆ·ç«¯èº«ä»½ã€‘â† ç¬¬äºŒé‡éªŒè¯
  â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚        â”‚          â”‚
  â”‚        â”‚ 6.è¿”å›ä»¤ç‰Œ â”‚
  â”‚        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚

  ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯ä¸¤è€…ï¼Ÿ

  éªŒè¯ç”¨æˆ·çš„å¿…è¦æ€§

  // ç”¨æˆ·è®¤è¯ä»£ç ç¤ºä¾‹
  @Override
  public UserDetails loadUserByUsername(String username) {
      User user = userRepository.findByUsername(username)
          .orElseThrow(() -> new UsernameNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));

      // éªŒè¯ç”¨æˆ·èº«ä»½å’ŒçŠ¶æ€
      return org.springframework.security.core.userdetails.User.builder()
          .username(user.getUsername())
          .password(user.getPassword())  // Spring SecurityéªŒè¯å¯†ç 
          .enabled(user.getEnabled())    // éªŒè¯è´¦æˆ·æ˜¯å¦æ¿€æ´»
          .authorities(user.getAuthorities())
          .build();
  }

  ä½œç”¨ï¼š
  - ç¡®ä¿æ˜¯åˆæ³•ç”¨æˆ·åœ¨è¿›è¡Œæˆæƒ
  - é˜²æ­¢æœªæˆæƒè®¿é—®
  - ç¡®å®šç”¨æˆ·çš„æƒé™èŒƒå›´

  éªŒè¯å®¢æˆ·ç«¯çš„å¿…è¦æ€§

  // å®¢æˆ·ç«¯éªŒè¯ä»£ç ç¤ºä¾‹
  @Bean
  public RegisteredClientRepository registeredClientRepository() {
      RegisteredClient client = RegisteredClient.withId("react-client-id")
          .clientId("react-client")           // å®¢æˆ·ç«¯æ ‡è¯†
          .clientSecret("{bcrypt}$2a$10...") // å®¢æˆ·ç«¯å¯†é’¥
          .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_POST)
          .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
          .redirectUri("http://localhost:3000/oauth2/callback")
          .scope("read")
          .build();

      return new InMemoryRegisteredClientRepository(client);
  }

  ä½œç”¨ï¼š
  - ç¡®ä¿åªæœ‰æ³¨å†Œçš„å®¢æˆ·ç«¯èƒ½è·å–ä»¤ç‰Œ
  - é˜²æ­¢æ¶æ„åº”ç”¨å†’å……
  - æ§åˆ¶å®¢æˆ·ç«¯çš„æƒé™èŒƒå›´

  ğŸš¨ ç¼ºå°‘ä»»ä¸€éªŒè¯çš„å®‰å…¨é£é™©

  å¦‚æœåªéªŒè¯ç”¨æˆ·ï¼Œä¸éªŒè¯å®¢æˆ·ç«¯ï¼š

  æ”»å‡»åœºæ™¯ï¼š
  1. æ¶æ„åº”ç”¨è·å¾—ç”¨æˆ·æˆæƒç ï¼ˆé€šè¿‡é‡å®šå‘åŠ«æŒï¼‰
  2. æ¶æ„åº”ç”¨ç›´æ¥ç”¨æˆæƒç æ¢å–ä»¤ç‰Œ
  3. ç”±äºä¸éªŒè¯å®¢æˆ·ç«¯èº«ä»½ï¼ŒæˆæƒæœåŠ¡å™¨å‘æ”¾ä»¤ç‰Œ
  4. æ¶æ„åº”ç”¨è·å¾—ç”¨æˆ·æ•°æ®è®¿é—®æƒé™

  ç»“æœï¼šåˆæ³•ç”¨æˆ·çš„æ•°æ®è¢«éæ³•åº”ç”¨è®¿é—®

  å¦‚æœåªéªŒè¯å®¢æˆ·ç«¯ï¼Œä¸éªŒè¯ç”¨æˆ·ï¼š

  æ”»å‡»åœºæ™¯ï¼š
  1. æ¶æ„ç”¨æˆ·æˆ–æ”»å‡»è€…ç›´æ¥è®¿é—®å®¢æˆ·ç«¯
  2. å®¢æˆ·ç«¯é€šè¿‡å®¢æˆ·ç«¯å‡­è¯è·å¾—ä»¤ç‰Œ
  3. ç”±äºä¸éªŒè¯å…·ä½“ç”¨æˆ·èº«ä»½ï¼Œä»»ä½•äººéƒ½èƒ½è®¿é—®
  4. ç³»ç»Ÿæ— æ³•åŒºåˆ†ä¸åŒç”¨æˆ·çš„æ•°æ®

  ç»“æœï¼šæ— æ³•å®ç°ç”¨æˆ·çº§åˆ«çš„æƒé™æ§åˆ¶

  ğŸ” Spring Securityä¸­çš„åŒé‡éªŒè¯å®ç°

  ç”¨æˆ·éªŒè¯é…ç½®ï¼š

  @Bean
  @Order(2)
  public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
      http.authorizeHttpRequests(authorize ->
              authorize.anyRequest().authenticated()  // è¦æ±‚ç”¨æˆ·è®¤è¯
          )
          .formLogin(formLogin ->
              formLogin.loginPage("/login")  // ç”¨æˆ·ç™»å½•é¡µé¢
          );
      return http.build();
  }

  å®¢æˆ·ç«¯éªŒè¯é…ç½®ï¼š

  @Bean
  @Order(1)
  public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
      OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
      // å†…éƒ¨ä¼šéªŒè¯å®¢æˆ·ç«¯å‡­è¯ï¼ˆclient_id + client_secretï¼‰
      return http.build();
  }

  ğŸ’¡ å®é™…éªŒè¯æµç¨‹

  æ­¥éª¤3çš„ç”¨æˆ·éªŒè¯ï¼š

  POST /login HTTP/1.1
  Host: localhost:8081
  Content-Type: application/x-www-form-urlencoded

  username=admin&password=password

  # Spring SecurityéªŒè¯ç”¨æˆ·å‡­è¯
  # CustomUserDetailsService.loadUserByUsername() è¢«è°ƒç”¨
  # éªŒè¯å¯†ç ï¼ŒåŠ è½½ç”¨æˆ·æƒé™

  æ­¥éª¤5çš„å®¢æˆ·ç«¯éªŒè¯ï¼š

  POST /oauth2/token HTTP/1.1
  Host: localhost:8081
  Authorization: Basic cmVhY3QtY2xpZW50OnJlYWN0LXNlY3JldA==
  Content-Type: application/x-www-form-urlencoded

  grant_type=authorization_code&
  code=abc123&
  redirect_uri=http://localhost:3000/oauth2/callback

  # Spring Authorization ServeréªŒè¯ï¼š
  # 1. è§£ç Authorization headerå¾—åˆ°client_idå’Œclient_secret
  # 2. ä»RegisteredClientRepositoryæŸ¥æ‰¾å®¢æˆ·ç«¯
  # 3. éªŒè¯å®¢æˆ·ç«¯å¯†é’¥
  # 4. éªŒè¯æˆæƒç æ˜¯å¦å±äºè¯¥å®¢æˆ·ç«¯
  # 5. éªŒè¯redirect_uriæ˜¯å¦åŒ¹é…

  ğŸ¯ æ€»ç»“

  OAuth2æˆæƒæœåŠ¡å™¨æ‰¿æ‹…åŒé‡å®ˆé—¨å‘˜çš„è´£ä»»ï¼š

  1. ç”¨æˆ·éªŒè¯ï¼šç¡®ä¿"æ˜¯åˆæ³•ç”¨æˆ·åœ¨æˆæƒ"
  2. å®¢æˆ·ç«¯éªŒè¯ï¼šç¡®ä¿"åˆæ³•åº”ç”¨åœ¨è·å–ä»¤ç‰Œ"

  è¿™ä¸¤ä¸ªéªŒè¯ç¼ºä¸€ä¸å¯ï¼Œå…±åŒæ„æˆOAuth2çš„å®‰å…¨åŸºç¡€ã€‚å°±åƒè¿›å…¥é“¶è¡Œé‡‘åº“éœ€è¦ä¸¤æŠŠé’¥åŒ™ä¸€æ ·ï¼ŒOAuth2ä¹Ÿéœ€è¦ç”¨æˆ·æˆæƒå’Œå®¢æˆ·ç«¯è®¤è¯ä¸¤
  ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œæ‰èƒ½æœ€ç»ˆè·å¾—è®¿é—®ä»¤ç‰Œã€‚

> éªŒè¯ç”¨æˆ·è¿™ä¸ªæˆ‘å¯ä»¥ç†è§£ï¼Œä½†æ˜¯å®¢æˆ·ç«¯æ˜¯ä¸ªè¦å¦‚ä½•éªŒè¯å‘¢ï¼Ÿ
  æˆ‘ä½¿ç”¨çš„åœºæ™¯ä¸€èˆ¬å®¢æˆ·ç«¯æ˜¯æµè§ˆå™¨ï¼Œç±»ä¼¼chromeæµè§ˆå™¨ï¼Œæˆ‘æƒ³çŸ¥é“æˆæƒæœåŠ¡å…¶å¦‚ä½•éªŒè¯chromeæµè§ˆå™¨çš„è¿™ç§å®¢æˆ·ç«¯æŠ½è±¡å‘¢ï¼Ÿ

âœ» Thinkingâ€¦

  è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼ç”¨æˆ·å¯¹OAuth2ä¸­"å®¢æˆ·ç«¯"çš„æ¦‚å¿µæœ‰äº›è¯¯è§£ã€‚ä»–ä»¬è®¤ä¸ºå®¢æˆ·ç«¯å°±æ˜¯æµè§ˆå™¨ï¼ˆæ¯”å¦‚Chromeï¼‰ï¼Œä½†å®é™…ä¸Šåœ¨OAuth2ä¸­
  ï¼Œå®¢æˆ·ç«¯å¹¶ä¸æ˜¯æµè§ˆå™¨æœ¬èº«ï¼Œè€Œæ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„åº”ç”¨ç¨‹åºã€‚

  è®©æˆ‘æ¥æ¾„æ¸…è¿™ä¸ªæ¦‚å¿µï¼š

  1. æµè§ˆå™¨ä¸æ˜¯OAuth2ä¸­çš„å®¢æˆ·ç«¯
  2. è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„åº”ç”¨ç¨‹åºï¼ˆæ¯”å¦‚Reactåº”ç”¨ã€Vueåº”ç”¨ç­‰ï¼‰æ‰æ˜¯å®¢æˆ·ç«¯
  3. å¯¹äºä¸åŒç±»å‹çš„å®¢æˆ·ç«¯ï¼ŒéªŒè¯æ–¹å¼æ˜¯ä¸åŒçš„

  æˆ‘éœ€è¦è¯¦ç»†è§£é‡Šï¼š
  - ä»€ä¹ˆæ˜¯OAuth2ä¸­çš„å®¢æˆ·ç«¯
  - ä¸åŒç±»å‹å®¢æˆ·ç«¯çš„éªŒè¯æ–¹å¼
  - ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¸æ˜¯å®¢æˆ·ç«¯
  - SPAï¼ˆå•é¡µåº”ç”¨ï¼‰å¦‚ä½•è¿›è¡Œå®¢æˆ·ç«¯éªŒè¯
  - å…¬å¼€å®¢æˆ·ç«¯vsæœºå¯†å®¢æˆ·ç«¯çš„åŒºåˆ«

â— è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µæ¾„æ¸…ï¼ä½ çš„ç†è§£æœ‰ä¸€ä¸ªå…³é”®è¯¯åŒºï¼š

  ğŸš¨ é‡è¦æ¦‚å¿µæ¾„æ¸…

  Chromeæµè§ˆå™¨ä¸æ˜¯OAuth2ä¸­çš„"å®¢æˆ·ç«¯"ï¼

  OAuth2ä¸­çš„"å®¢æˆ·ç«¯"æ˜¯æŒ‡è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„åº”ç”¨ç¨‹åºï¼Œä¸æ˜¯æµè§ˆå™¨æœ¬èº«ã€‚

  ğŸ¯ ä»€ä¹ˆæ˜¯OAuth2ä¸­çš„"å®¢æˆ·ç«¯"ï¼Ÿ

  å®¢æˆ·ç«¯ = åº”ç”¨ç¨‹åºï¼Œä¸æ˜¯æµè§ˆå™¨

  âŒ é”™è¯¯ç†è§£ï¼š
  å®¢æˆ·ç«¯ = Chromeæµè§ˆå™¨

  âœ… æ­£ç¡®ç†è§£ï¼š
  å®¢æˆ·ç«¯ = è¿è¡Œåœ¨Chromeä¸­çš„Reactåº”ç”¨
  å®¢æˆ·ç«¯ = è¿è¡Œåœ¨Chromeä¸­çš„Vueåº”ç”¨
  å®¢æˆ·ç«¯ = è¿è¡Œåœ¨Chromeä¸­çš„Angularåº”ç”¨

  å…·ä½“ç¤ºä¾‹

  åœºæ™¯1ï¼šç”¨æˆ·åœ¨Chromeä¸­è®¿é—®GitHubç½‘ç«™
  - æµè§ˆå™¨ï¼šChromeï¼ˆåªæ˜¯è½½ä½“ï¼‰
  - OAuth2å®¢æˆ·ç«¯ï¼šGitHubçš„Webåº”ç”¨
  - å®¢æˆ·ç«¯IDï¼šgithub-web-client

  åœºæ™¯2ï¼šç”¨æˆ·åœ¨Chromeä¸­è®¿é—®ä½ çš„Reactåº”ç”¨
  - æµè§ˆå™¨ï¼šChromeï¼ˆåªæ˜¯è½½ä½“ï¼‰
  - OAuth2å®¢æˆ·ç«¯ï¼šä½ çš„Reactåº”ç”¨
  - å®¢æˆ·ç«¯IDï¼šreact-client

  ğŸ” å®¢æˆ·ç«¯ç±»å‹å’ŒéªŒè¯æ–¹å¼

  1. æœºå¯†å®¢æˆ·ç«¯ï¼ˆConfidential Clientï¼‰

  ç‰¹ç‚¹ï¼šèƒ½å¤Ÿå®‰å…¨å­˜å‚¨å®¢æˆ·ç«¯å¯†é’¥
  // æœåŠ¡ç«¯Webåº”ç”¨
  @Component
  public class WebAppClient {
      // å¯ä»¥å®‰å…¨å­˜å‚¨åœ¨æœåŠ¡å™¨é…ç½®ä¸­
      private String clientSecret = "very-secret-key-123";

      public void exchangeToken(String code) {
          // æœåŠ¡ç«¯åˆ°æœåŠ¡ç«¯çš„è¯·æ±‚ï¼Œå¯ä»¥å®‰å…¨ä¼ è¾“å¯†é’¥
          HttpHeaders headers = new HttpHeaders();
          headers.setBasicAuth(clientId, clientSecret);  // å®‰å…¨ï¼
      }
  }

  éªŒè¯æ–¹å¼ï¼šä½¿ç”¨client_secret
  POST /oauth2/token
  Authorization: Basic base64(client_id:client_secret)
  Body: grant_type=authorization_code&code=...

  2. å…¬å¼€å®¢æˆ·ç«¯ï¼ˆPublic Clientï¼‰

  ç‰¹ç‚¹ï¼šæ— æ³•å®‰å…¨å­˜å‚¨å®¢æˆ·ç«¯å¯†é’¥
  // å‰ç«¯Reactåº”ç”¨
  class ReactOAuth2Client {
      constructor() {
          this.clientId = 'react-client';
          // âŒ ä¸èƒ½å­˜å‚¨å¯†é’¥ï¼ä»»ä½•äººéƒ½èƒ½åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°
          // this.clientSecret = 'secret'; // è¿™æ ·åšæ˜¯å±é™©çš„ï¼
      }
  }

  éªŒè¯æ–¹å¼ï¼šä½¿ç”¨å…¶ä»–æ–¹æ³•
  - PKCEï¼ˆæ¨èï¼‰
  - é‡å®šå‘URIéªŒè¯
  - å®¢æˆ·ç«¯æ³¨å†Œä¿¡æ¯

  ğŸ›¡ï¸ å…¬å¼€å®¢æˆ·ç«¯çš„éªŒè¯æ–¹æ³•

  æ–¹æ³•1ï¼šPKCEéªŒè¯ï¼ˆæœ€å®‰å…¨ï¼‰

  // Reactåº”ç”¨ç”ŸæˆPKCEå‚æ•°
  class OAuth2Service {
      authorize() {
          // 1. ç”ŸæˆéšæœºéªŒè¯ç 

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚Â >Â                                                                                                                                                                                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  âµâµ accept edits on (shift+tab to cycle)
              `client_id=${this.clientId}&` +
              `code_challenge=${codeChallenge}&` +
              `code_challenge_method=S256&` +
              `...`;

          localStorage.setItem('code_verifier', codeVerifier);
          window.location.href = authUrl;
      }

      async handleCallback(code) {
          const codeVerifier = localStorage.getItem('code_verifier');

          // 3. ä»¤ç‰Œè¯·æ±‚åŒ…å«verifier
          const response = await fetch('/oauth2/token', {
              method: 'POST',
              body: new URLSearchParams({
                  grant_type: 'authorization_code',
                  client_id: this.clientId,
                  code: code,
                  code_verifier: codeVerifier  // éªŒè¯å®¢æˆ·ç«¯èº«ä»½
              })
          });
      }
  }

  PKCEéªŒè¯åŸç†ï¼š
  æˆæƒæœåŠ¡å™¨éªŒè¯é€»è¾‘ï¼š
  1. æ”¶åˆ°æˆæƒè¯·æ±‚æ—¶ï¼Œå­˜å‚¨ code_challenge
  2. æ”¶åˆ°ä»¤ç‰Œè¯·æ±‚æ—¶ï¼ŒéªŒè¯ï¼š
     SHA256(code_verifier) === stored_code_challenge
  3. åªæœ‰ç”Ÿæˆchallengeçš„å®¢æˆ·ç«¯æ‰æœ‰verifier
  4. å³ä½¿æˆæƒç è¢«æ‹¦æˆªï¼Œæ²¡æœ‰verifierä¹Ÿæ— æ³•æ¢å–ä»¤ç‰Œ

  æ–¹æ³•2ï¼šé‡å®šå‘URIéªŒè¯

  // æˆæƒæœåŠ¡å™¨éªŒè¯é‡å®šå‘URI
  @Service
  public class ClientValidationService {

      public boolean validateClient(String clientId, String redirectUri) {
          RegisteredClient client = clientRepository.findByClientId(clientId);

          // éªŒè¯é‡å®šå‘URIæ˜¯å¦åœ¨æ³¨å†Œåˆ—è¡¨ä¸­
          return client.getRedirectUris().contains(redirectUri);
      }
  }

  éªŒè¯é€»è¾‘ï¼š
  æ³¨å†Œæ—¶ï¼šreact-client åªèƒ½é‡å®šå‘åˆ° http://localhost:3000/*
  è¿è¡Œæ—¶ï¼šå¦‚æœæœ‰äººè¯•å›¾é‡å®šå‘åˆ° http://evil.comï¼ŒéªŒè¯å¤±è´¥ï¼

  æ–¹æ³•3ï¼šå®¢æˆ·ç«¯æ³¨å†ŒéªŒè¯

  // å®¢æˆ·ç«¯æ³¨å†Œä¿¡æ¯éªŒè¯
  @Bean
  public RegisteredClient reactClient() {
      return RegisteredClient.withId("react-client-id")
          .clientId("react-client")
          // æ³¨æ„ï¼šå…¬å¼€å®¢æˆ·ç«¯æ²¡æœ‰å¯†é’¥ï¼
          .clientAuthenticationMethod(ClientAuthenticationMethod.NONE)
          .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚Â >Â                                                                                                                                                                                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  âµâµ accept edits on (shift+tab to cycle)                                                                                                                                    Auto-updatingâ€¦
                                                                                                                                                                                               }

  ğŸ“Š éªŒè¯æ–¹å¼å¯¹æ¯”

  | å®¢æˆ·ç«¯ç±»å‹ | éªŒè¯æ–¹æ³•          | å®‰å…¨çº§åˆ« | é€‚ç”¨åœºæ™¯         |
  |-------|---------------|------|--------------|
  | æœºå¯†å®¢æˆ·ç«¯ | client_secret | ğŸ”’ é«˜ | æœåŠ¡ç«¯Webåº”ç”¨     |
  | å…¬å¼€å®¢æˆ·ç«¯ | PKCE          | ğŸ”’ é«˜ | SPAã€ç§»åŠ¨åº”ç”¨ï¼ˆæ¨èï¼‰ |
  | å…¬å¼€å®¢æˆ·ç«¯ | é‡å®šå‘URI        | ğŸ” ä¸­ | ç®€å•Webåº”ç”¨      |
  | å…¬å¼€å®¢æˆ·ç«¯ | æ— éªŒè¯           | âš ï¸ ä½ | ä»…å¼€å‘ç¯å¢ƒ        |

  ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹

  ä½ çš„Reactåº”ç”¨éªŒè¯æµç¨‹ï¼š

  // 1. Reactåº”ç”¨é…ç½®ï¼ˆå…¬å¼€å®¢æˆ·ç«¯ï¼‰
  const oauth2Config = {
      clientId: 'react-client',        // å…¬å¼€çš„æ ‡è¯†ç¬¦
      // æ³¨æ„ï¼šæ²¡æœ‰clientSecretï¼
      redirectUri: 'http://localhost:3000/oauth2/callback',
      codeChallenge: generatePKCE()    // PKCEéªŒè¯
  };

  // 2. æˆæƒè¯·æ±‚
  GET /oauth2/authorize?
      client_id=react-client&
      redirect_uri=http://localhost:3000/oauth2/callback&
      code_challenge=dBjftJeZ...&
      code_challenge_method=S256

  // 3. ä»¤ç‰Œè¯·æ±‚
  POST /oauth2/token
  Content-Type: application/x-www-form-urlencoded

  grant_type=authorization_code&
  client_id=react-client&              // å®¢æˆ·ç«¯æ ‡è¯†
  code=received_auth_code&
  redirect_uri=http://localhost:3000/oauth2/callback&
  code_verifier=dBjftJeZ...           // PKCEéªŒè¯ç 

  æˆæƒæœåŠ¡å™¨çš„éªŒè¯é€»è¾‘ï¼š

  @Component
  public class OAuth2TokenEndpoint {

      public ResponseEntity<?> token(TokenRequest request) {
          // 1. æ ¹æ®client_idæŸ¥æ‰¾å®¢æˆ·ç«¯é…ç½®
          RegisteredClient client = findClientById(request.getClientId());

          // 2. éªŒè¯å®¢æˆ·ç«¯ç±»å‹
          if (client.getClientAuthenticationMethod() == ClientAuthenticationMethod.NONE) {
              // å…¬å¼€å®¢æˆ·ç«¯ï¼Œä½¿ç”¨PKCEéªŒè¯
              if (!validatePKCE(request.getCodeVerifier(), storedChallenge)) {
                  return ResponseEntity.badRequest().body("PKCEéªŒè¯å¤±è´¥");
              }
          } else {
              // æœºå¯†å®¢æˆ·ç«¯ï¼Œä½¿ç”¨å¯†é’¥éªŒè¯
              if (!validateClientSecret(request.getClientSecret(), client.getSecret())) {
                  return ResponseEntity.badRequest().body("å®¢æˆ·ç«¯å¯†é’¥é”™è¯¯");
              }
          }

          // 3. éªŒè¯é‡å®šå‘URI
          if (!client.getRedirectUris().contains(request.getRedirectUri())) {
              return ResponseEntity.badRequest().body("æ— æ•ˆçš„é‡å®šå‘URI");
          }

          // 4. ç”Ÿæˆä»¤ç‰Œ
          return ResponseEntity.ok(generateTokens());
      }
  }

  ğŸ’¡ å…³é”®ç†è§£

  1. æµè§ˆå™¨ â‰  å®¢æˆ·ç«¯ï¼šæµè§ˆå™¨åªæ˜¯è¿è¡Œç¯å¢ƒï¼ŒReactåº”ç”¨æ‰æ˜¯OAuth2å®¢æˆ·ç«¯
  2. å…¬å¼€å®¢æˆ·ç«¯æ— å¯†é’¥ï¼šå‰ç«¯åº”ç”¨æ— æ³•å®‰å…¨å­˜å‚¨å¯†é’¥ï¼Œå¿…é¡»ä½¿ç”¨å…¶ä»–éªŒè¯æ–¹æ³•
  3. PKCEæ˜¯æœ€ä½³å®è·µï¼šä¸ºå…¬å¼€å®¢æˆ·ç«¯æä¾›äº†ä¸å¯†é’¥éªŒè¯ç›¸å½“çš„å®‰å…¨æ€§
  4. å¤šé‡éªŒè¯æœºåˆ¶ï¼šclientId + PKCE + redirectUri + æˆæƒç ï¼Œå¤šå±‚é˜²æŠ¤

  æ‰€ä»¥ï¼ŒæˆæƒæœåŠ¡å™¨éªŒè¯çš„ä¸æ˜¯Chromeæµè§ˆå™¨ï¼Œè€Œæ˜¯ä½ åœ¨Chromeä¸­è¿è¡Œçš„Reactåº”ç”¨ï¼