ç®—äº†ï¼Œæˆ‘åˆ é™¤äº†ï¼Œå…¶ä»–åœ°æ–¹æœ‰æŠ¥é”™ï¼Œæš‚æ—¶ä¸åˆ é™¤äº†ï¼›
  æˆ‘ç°åœ¨æƒ³äº†è§£æ¸…æ¥šå®ƒä»¬çš„åŠŸèƒ½ï¼›
  ä¾‹å¦‚ï¼šcn.bochk.pap.server.system.api.configè¿™ä¸ªåŒ…ä¸‹çš„æ¥å£å’Œç±»ï¼›

âœ» Thinkingâ€¦

  ç”¨æˆ·æƒ³äº†è§£ cn.bochk.pap.server.system.api.config åŒ…ä¸‹çš„æ¥å£å’Œç±»çš„åŠŸèƒ½ã€‚è®©æˆ‘æŸ¥çœ‹è¿™ä¸ªåŒ…ä¸‹çš„ä»£ç ï¼Œåˆ†æå…¶å…·ä½“åŠŸèƒ½ã€‚

â— è®©æˆ‘æ¥å¸®ä½ è¯¦ç»†åˆ†æ cn.bochk.pap.server.system.api.config åŒ…ä¸‹çš„åŠŸèƒ½ã€‚

â— Read(pocpro\pap-server\src\main\java\cn\bochk\pap\server\system\api\config\ConfigApi.java)
  â¿ Â Read 19 lines (ctrl+r to expand)

â— Read(pocpro\pap-server\src\main\java\cn\bochk\pap\server\system\api\config\ConfigApiImpl.java)
  â¿ Â Read 28 lines (ctrl+r to expand)

âœ» Thinkingâ€¦

  ç°åœ¨æˆ‘çœ‹åˆ°äº† ConfigApi çš„æ¥å£å’Œå®ç°ç±»ã€‚è®©æˆ‘å†æŸ¥çœ‹ä¸€ä¸‹ç›¸å…³çš„ ConfigService å’Œ ConfigDOï¼Œä»¥åŠ
  Controllerï¼Œæ¥å…¨é¢äº†è§£è¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½ã€‚

â— è®©æˆ‘æŸ¥çœ‹å¯¹åº”çš„Serviceå±‚å’Œæ•°æ®å¯¹è±¡ï¼Œä»¥åŠControllerï¼Œæ¥å…¨é¢äº†è§£è¿™ä¸ªé…ç½®æ¨¡å—ï¼š

â— Read(pocpro\pap-server\src\main\java\cn\bochk\pap\server\system\service\config\ConfigService.java)
  â¿ Â Read 50 lines (ctrl+r to expand)

â— Read(pocpro\pap-server\src\main\java\cn\bochk\pap\server\system\dal\dataobject\config\ConfigDO.java)
  â¿ Â Read 65 lines (ctrl+r to expand)

â— Read(pocpro\pap-server\src\main\java\cn\bochk\pap\server\system\controller\admin\config\ConfigController.java)
  â¿ Â Read 50 lines (ctrl+r to expand)

âœ» Thinkingâ€¦

  ç°åœ¨æˆ‘å·²ç»çœ‹åˆ°äº† ConfigApi
  çš„å…¨è²Œï¼ŒåŒ…æ‹¬æ¥å£ã€å®ç°ã€Serviceã€æ•°æ®å¯¹è±¡å’ŒControllerã€‚è®©æˆ‘å†æŸ¥çœ‹ä¸€ä¸‹ConfigTypeEnumæ¥äº†è§£å‚æ•°ç±»å‹ã€‚

â— è®©æˆ‘æŸ¥çœ‹é…ç½®ç±»å‹æšä¸¾ï¼Œä»¥å®Œæ•´äº†è§£è¿™ä¸ªé…ç½®æ¨¡å—ï¼š

â— Read(pocpro\pap-server\src\main\java\cn\bochk\pap\server\system\enums\config\ConfigTypeEnum.java)
  â¿ Â Read 22 lines (ctrl+r to expand)

â— Read(pocpro\pap-server\src\main\java\cn\bochk\pap\server\system\service\config\ConfigServiceImpl.java)
  â¿ Â Read 30 lines (ctrl+r to expand)

âœ» Thinkingâ€¦

  è®©æˆ‘å†æœç´¢ä¸€ä¸‹æ˜¯å¦æœ‰å…¶ä»–æ¨¡å—ä½¿ç”¨äº†è¿™ä¸ªConfigApiï¼Œä»¥åŠæŸ¥çœ‹ä¸€äº›å…·ä½“çš„ä½¿ç”¨åœºæ™¯ã€‚

â— è®©æˆ‘æœç´¢ä¸€ä¸‹è¿™ä¸ªConfigApiåœ¨é¡¹ç›®ä¸­çš„å…·ä½“ä½¿ç”¨åœºæ™¯ï¼š

â— Search(pattern: "ConfigApi", path: "pocpro")
  â¿ Â Found 2 files (ctrl+r to expand)

â— Search(pattern: "getConfigValueByKey", path: "pocpro", output_mode: "content", head_limit: 10)
  â¿ Â Found 3 lines (ctrl+r to expand)

âœ» Thinkingâ€¦

  ç°åœ¨æˆ‘äº†è§£äº†è¿™ä¸ªConfigApiçš„ç”¨é€”ã€‚è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹åœ¨AdminUserServiceImplä¸­çš„å…·ä½“ä½¿ç”¨åœºæ™¯ï¼š

â— è®©æˆ‘æŸ¥çœ‹ConfigApiåœ¨ç”¨æˆ·æœåŠ¡ä¸­çš„å…·ä½“ä½¿ç”¨åœºæ™¯ï¼š

â— Search(pattern: "USER_REGISTER_ENABLED_KEY|USER_INIT_PASSWORD_KEY", path: "pocpro", output_mode: "content")
  â¿ Â Found 24 lines (ctrl+r to expand)

âœ» Thinkingâ€¦

  ç°åœ¨æˆ‘å¯¹è¿™ä¸ª ConfigApi çš„åŠŸèƒ½æœ‰äº†æ¸…æ™°çš„ç†è§£ã€‚è®©æˆ‘æ•´ç†ä¸€ä¸‹è¿™ä¸ªæ¨¡å—çš„å®Œæ•´åŠŸèƒ½åˆ†æã€‚

â— ğŸ¯ cn.bochk.pap.server.system.api.config åŒ…åŠŸèƒ½è¯¦è§£

  ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½ï¼šç³»ç»Ÿå‚æ•°é…ç½®ç®¡ç†

  è¿™ä¸ªåŒ…æä¾›äº†ç³»ç»Ÿè¿è¡Œæ—¶é…ç½®å‚æ•°çš„ç®¡ç†åŠŸèƒ½ï¼Œå…è®¸åŠ¨æ€é…ç½®ç³»ç»Ÿè¡Œä¸ºè€Œæ— éœ€é‡å¯æœåŠ¡ã€‚

  ğŸ” è¯¦ç»†åˆ†æï¼š

  1. API æ¥å£å±‚

  public interface ConfigApi {
      /**
       * æ ¹æ®å‚æ•°é”®æŸ¥è¯¢å‚æ•°å€¼ - ä¾›å…¶ä»–æ¨¡å—è°ƒç”¨
       */
      String getConfigValueByKey(String key);
  }

  2. æ•°æ®ç»“æ„ (ConfigDO)

  @TableName("infra_config")
  public class ConfigDO extends BaseDO {
      private Long id;              // ä¸»é”®
      private String category;      // å‚æ•°åˆ†ç±»ï¼ˆå¦‚ï¼šç³»ç»Ÿè®¾ç½®ã€ç”¨æˆ·è®¾ç½®ï¼‰
      private String name;          // å‚æ•°åç§°ï¼ˆæ˜¾ç¤ºç”¨ï¼‰
      private String configKey;     // å‚æ•°é”®åï¼ˆç¨‹åºä½¿ç”¨ï¼‰
      private String value;         // å‚æ•°å€¼
      private Integer type;         // å‚æ•°ç±»å‹ï¼š1=ç³»ç»Ÿé…ç½®ï¼Œ2=è‡ªå®šä¹‰é…ç½®
      private Boolean visible;      // æ˜¯å¦å¯è§ï¼ˆæ•æ„Ÿå‚æ•°è®¾ä¸ºfalseï¼‰
      private String remark;        // å¤‡æ³¨è¯´æ˜
  }

  3. å…·ä½“ä½¿ç”¨åœºæ™¯

  åœ¨ç”¨æˆ·æœåŠ¡ä¸­çš„å®é™…åº”ç”¨ï¼š

  // åœºæ™¯1ï¼šæ§åˆ¶ç”¨æˆ·æ³¨å†Œå¼€å…³
  static final String USER_REGISTER_ENABLED_KEY = "system.user.register-enabled";

  public Long registerUser(AuthRegisterReqVO registerReqVO) {
      // æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å…è®¸ç”¨æˆ·æ³¨å†Œ
      if (!Objects.equals(configApi.getConfigValueByKey(USER_REGISTER_ENABLED_KEY), "true")) {
          throw exception(USER_REGISTER_DISABLED);  // æ³¨å†ŒåŠŸèƒ½å·²å…³é—­
      }
      // ç»§ç»­æ³¨å†Œé€»è¾‘...
  }

  // åœºæ™¯2ï¼šè®¾ç½®ç”¨æˆ·åˆå§‹å¯†ç 
  static final String USER_INIT_PASSWORD_KEY = "system.user.init-password";

  public UserImportRespVO importUserList(List<UserImportExcelVO> importUsers) {
      // è·å–ç³»ç»Ÿé…ç½®çš„åˆå§‹å¯†ç 
      String initPassword = configApi.getConfigValueByKey(USER_INIT_PASSWORD_KEY);
      if (StrUtil.isEmpty(initPassword)) {
          throw exception(USER_INIT_PASSWORD_NOT_CONFIG);
      }
      // ä½¿ç”¨åˆå§‹å¯†ç åˆ›å»ºç”¨æˆ·...
  }

  ğŸ¯ å®é™…åº”ç”¨ä»·å€¼ï¼š

  åŠ¨æ€é…ç½®èƒ½åŠ›ï¼š

  # æ•°æ®åº“é…ç½®ç¤ºä¾‹
  INSERT INTO infra_config VALUES
  (1, 'ç”¨æˆ·ç®¡ç†', 'æ˜¯å¦å…è®¸æ³¨å†Œ', 'system.user.register-enabled', 'true', 1, true, 'æ§åˆ¶å‰å°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½'),
  (2, 'ç”¨æˆ·ç®¡ç†', 'ç”¨æˆ·åˆå§‹å¯†ç ', 'system.user.init-password', '123456', 1, false, 'æ–°ç”¨æˆ·é»˜è®¤å¯†ç ');

  è¿è¥æ§åˆ¶åœºæ™¯ï¼š

  1. åŠŸèƒ½å¼€å…³ - å¿«é€Ÿå¼€å¯/å…³é—­æŸä¸ªåŠŸèƒ½ï¼ˆå¦‚æ³¨å†Œã€æ”¯ä»˜ï¼‰
  2. è¿è¥å‚æ•° - åŠ¨æ€è°ƒæ•´ä¸šåŠ¡å‚æ•°ï¼ˆå¦‚æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼‰
  3. æ•æ„Ÿé…ç½® - å­˜å‚¨APIå¯†é’¥ã€ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®ç­‰
  4. ç¯å¢ƒé€‚é… - ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®å€¼

  5. å‰ç«¯ç®¡ç†ç•Œé¢

  # ç®¡ç†å‘˜å¯ä»¥é€šè¿‡åå°ç•Œé¢ç®¡ç†è¿™äº›é…ç½®
  GET  /infra/config/page     # åˆ†é¡µæŸ¥è¯¢é…ç½®
  POST /infra/config/create   # æ–°å¢é…ç½®
  PUT  /infra/config/update   # ä¿®æ”¹é…ç½®
  DELETE /infra/config/delete # åˆ é™¤é…ç½®

  ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªAPIå±‚ï¼š

  âœ… åˆç†çš„å­˜åœ¨ï¼š

  1. é…ç½®ä¸­å¿ƒåŒ– - å…¶ä»–æ¨¡å—ç»Ÿä¸€ä»è¿™é‡Œè·å–é…ç½®
  2. è§£è€¦é…ç½®é€»è¾‘ - å…¶ä»–æ¨¡å—ä¸éœ€è¦çŸ¥é“é…ç½®çš„å­˜å‚¨ç»†èŠ‚
  3. ç¼“å­˜ä¼˜åŒ– - å¯ä»¥åœ¨APIå±‚åšé…ç½®ç¼“å­˜ï¼Œæé«˜æ€§èƒ½
  4. æƒé™æ§åˆ¶ - å¯ä»¥æ§åˆ¶å“ªäº›é…ç½®å¯¹å…¶ä»–æ¨¡å—å¯è§

  å®ç”¨æ€§å¾ˆå¼ºï¼š

  ä¸å‰é¢åˆ†æçš„UserApiä¸åŒï¼ŒConfigApiç¡®å®æœ‰å­˜åœ¨ä»·å€¼ï¼š

  // å…¶ä»–ä¸šåŠ¡æ¨¡å—å¯ä»¥æ–¹ä¾¿åœ°è·å–ç³»ç»Ÿé…ç½®
  @Resource
  private ConfigApi configApi;

  public void doSomething() {
      String maxFileSize = configApi.getConfigValueByKey("file.max-size");
      String emailEnabled = configApi.getConfigValueByKey("notification.email.enabled");
      // æ ¹æ®é…ç½®å†³å®šä¸šåŠ¡é€»è¾‘
  }

  ğŸ¯ æ€»ç»“ï¼š

  ConfigApiåŒ…çš„ä½œç”¨ï¼š
  - âœ… ç³»ç»Ÿé…ç½®ä¸­å¿ƒ - ç»Ÿä¸€ç®¡ç†ç³»ç»Ÿè¿è¡Œå‚æ•°
  - âœ… åŠ¨æ€é…ç½® - æ— éœ€é‡å¯å³å¯è°ƒæ•´ç³»ç»Ÿè¡Œä¸º
  - âœ… ä¸šåŠ¡å¼€å…³ - å¿«é€Ÿæ§åˆ¶åŠŸèƒ½çš„å¼€å¯å…³é—­
  - âœ… ç¯å¢ƒé€‚é… - æ”¯æŒä¸åŒç¯å¢ƒçš„é…ç½®å·®å¼‚åŒ–

  è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„æ¨¡å—ï¼Œå»ºè®®ä¿ç•™ã€‚å®ƒè§£å†³äº†é…ç½®ç®¡ç†çš„å®é™…éœ€æ±‚ï¼Œæ¯”ç®€å•çš„ç¡¬ç¼–ç é…ç½®è¦çµæ´»å¾—å¤šã€‚