
  1.  èº«ä»½è®¤è¯ç®¡ç†

  ç”¨æˆ·ç™»å½•

  @PostMapping("/login")
  @PermitAll  // å…¬å¼€æ¥å£ï¼Œæ— éœ€è®¤è¯
  login(AuthLoginReqVO) â†’ AuthLoginRespVO

  // åŠŸèƒ½ï¼šéªŒè¯ç”¨æˆ·åå¯†ç ï¼Œç”Ÿæˆè®¿é—®ä»¤ç‰Œ
  // è¿”å›ï¼šç”¨æˆ·ä¿¡æ¯ + accessToken + refreshToken

  ç”¨æˆ·ç™»å‡º

  @PostMapping("/logout")
  @PermitAll  // å…¬å¼€æ¥å£
  logout(HttpServletRequest) â†’ Boolean

  // åŠŸèƒ½ï¼šæ³¨é”€å½“å‰ä¼šè¯ï¼Œå¤±æ•ˆè®¿é—®ä»¤ç‰Œ
  // ç‰¹ç‚¹ï¼šä»è¯·æ±‚å¤´æˆ–å‚æ•°ä¸­æå–tokenè¿›è¡Œæ³¨é”€

  ä»¤ç‰Œåˆ·æ–°

  @PostMapping("/refresh-token")
  @PermitAll  // å…¬å¼€æ¥å£
  refreshToken(String refreshToken) â†’ AuthLoginRespVO

  // åŠŸèƒ½ï¼šä½¿ç”¨refreshTokenè·å–æ–°çš„accessToken
  // ç›®çš„ï¼šå»¶é•¿ç”¨æˆ·ä¼šè¯ï¼Œé¿å…é¢‘ç¹ç™»å½•

  2. ğŸ‘¤ ç”¨æˆ·æ³¨å†Œç®¡ç†

  @PostMapping("/register")
  @PermitAll  // å…¬å¼€æ¥å£
  register(AuthRegisterReqVO) â†’ AuthLoginRespVO

  // åŠŸèƒ½ï¼šæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•
  // è¿”å›ï¼šæ³¨å†Œç”¨æˆ·ä¿¡æ¯ + ç™»å½•ä»¤ç‰Œ

  3.  å¯†ç é‡ç½®ç®¡ç†

  @PostMapping("/reset-password")
  @PermitAll  // å…¬å¼€æ¥å£
  resetPassword(AuthResetPasswordReqVO) â†’ Boolean

  // åŠŸèƒ½ï¼šé‡ç½®ç”¨æˆ·å¯†ç (é€šå¸¸éœ€è¦éªŒè¯ç éªŒè¯)
  // å®‰å…¨ï¼šé˜²æ­¢æ¶æ„é‡ç½®ï¼Œéœ€è¦èº«ä»½éªŒè¯

  4. æƒé™ä¿¡æ¯è·å– (æ ¸å¿ƒåŠŸèƒ½)

  @GetMapping("/get-permission-info")
  // éœ€è¦ç™»å½•åè®¿é—®(æ— @PermitAll)
  getPermissionInfo() â†’ AuthPermissionInfoRespVO

  è¿™æ˜¯æœ€å¤æ‚ä¹Ÿæœ€é‡è¦çš„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬è¯¦ç»†åˆ†æï¼š

  æƒé™ä¿¡æ¯è·å–æµç¨‹ï¼š

  æ­¥éª¤1: è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
  AdminUserDO user = userService.getUser(getLoginUserId());

  æ­¥éª¤2: è·å–ç”¨æˆ·è§’è‰²åˆ—è¡¨
  Set<Long> roleIds = permissionService.getUserRoleIdListByUserId(userId);
  List<RoleDO> roles = roleService.getRoleList(roleIds);
  // è¿‡æ»¤ç¦ç”¨è§’è‰²
  roles.removeIf(role â†’ !CommonStatusEnum.ENABLE.equals(role.getStatus()));

  æ­¥éª¤3: è·å–è§’è‰²å¯¹åº”çš„èœå•æƒé™
  Set<Long> menuIds = permissionService.getRoleMenuListByRoleId(roleIds);
  List<MenuDO> menuList = menuService.getMenuList(menuIds);
  // è¿‡æ»¤ç¦ç”¨èœå•
  menuList = menuService.filterDisableMenus(menuList);

  æ­¥éª¤4: ç»„è£…æƒé™ä¿¡æ¯è¿”å›
  return AuthConvert.INSTANCE.convert(user, roles, menuList);

  ---
   ä¾èµ–æœåŠ¡åˆ†æ

  å¤šæœåŠ¡åä½œæ¨¡å¼

  // AuthController ä¾èµ–äº†5ä¸ªæ ¸å¿ƒæœåŠ¡ï¼š

  @Resource AdminAuthService authService;      // è®¤è¯æ ¸å¿ƒæœåŠ¡
  @Resource AdminUserService userService;      // ç”¨æˆ·ç®¡ç†æœåŠ¡
  @Resource RoleService roleService;           // è§’è‰²ç®¡ç†æœåŠ¡
  @Resource MenuService menuService;           // èœå•ç®¡ç†æœåŠ¡
  @Resource PermissionService permissionService; // æƒé™å…³ç³»æœåŠ¡
  @Resource SecurityProperties securityProperties; // å®‰å…¨é…ç½®

  RBACæƒé™æ¨¡å‹å®ç°

  User â”€â”€â”€â”€ N:M â”€â”€â”€â”€ Role â”€â”€â”€â”€ N:M â”€â”€â”€â”€ Menu/Permission
   ç”¨æˆ·        è§’è‰²        èœå•/æƒé™

  // æƒé™æŸ¥è¯¢é“¾è·¯ï¼š
  ç”¨æˆ·ID â†’ è§’è‰²IDé›†åˆ â†’ èœå•IDé›†åˆ â†’ èœå•æƒé™ä¿¡æ¯

  ---
   å®‰å…¨è®¾è®¡ç‰¹ç‚¹

  âš¡ å…¬å¼€æ¥å£è®¾è®¡

  // æ‰€æœ‰è®¤è¯ç›¸å…³æ¥å£éƒ½æ ‡è®°ä¸º@PermitAll
  @PermitAll // ç™»å½•
  @PermitAll // ç™»å‡º
  @PermitAll // åˆ·æ–°ä»¤ç‰Œ
  @PermitAll // ç”¨æˆ·æ³¨å†Œ
  @PermitAll // é‡ç½®å¯†ç 

  // åªæœ‰æƒé™ä¿¡æ¯è·å–éœ€è¦ç™»å½•åè®¿é—®
  getPermissionInfo() // æ— @PermitAllï¼Œéœ€è¦è®¤è¯

  ğŸ”§ ä»¤ç‰Œå¤„ç†æœºåˆ¶

  // çµæ´»çš„ä»¤ç‰Œæå–æ–¹å¼
  String token = SecurityFrameworkUtils.obtainAuthorization(request,
      securityProperties.getTokenHeader(),      // ä»Headeræå–: Authorization
      securityProperties.getTokenParameter());  // ä»å‚æ•°æå–: ?token=xxx

   çŠ¶æ€è¿‡æ»¤æœºåˆ¶

  // å®‰å…¨è¿‡æ»¤ï¼šåªè¿”å›å¯ç”¨çŠ¶æ€çš„è§’è‰²å’Œèœå•
  roles.removeIf(role â†’ !CommonStatusEnum.ENABLE.equals(role.getStatus()));
  menuList = menuService.filterDisableMenus(menuList);

  ---
   æ•°æ®è½¬æ¢ç­–ç•¥

  ä½¿ç”¨MapStructè¿›è¡Œå¤æ‚è½¬æ¢

  // ä½¿ç”¨AuthConvertè¿›è¡Œå¤æ‚å¯¹è±¡ç»„è£…
  AuthConvert.INSTANCE.convert(user, roles, menuList)

  // ç›¸æ¯”å…¶ä»–Controllerä½¿ç”¨BeanUtilsï¼Œè¿™é‡Œéœ€è¦å¤æ‚çš„æƒé™ä¿¡æ¯æ•´åˆ
  // éœ€è¦å°†ç”¨æˆ·ã€è§’è‰²ã€èœå•ä¸‰ç§æ•°æ®æ•´åˆä¸ºæƒé™å“åº”å¯¹è±¡

  ---
   å‰ç«¯é›†æˆæ¨¡å¼

  å…¸å‹çš„å‰ç«¯ä½¿ç”¨æµç¨‹

  // 1. ç”¨æˆ·ç™»å½•
  POST /system/auth/login
  â†’ è·å¾— { accessToken, refreshToken, userInfo }

  // 2. è·å–æƒé™ä¿¡æ¯
  GET /system/auth/get-permission-info
  â†’ è·å¾— { user, roles, menus, permissions }

  // 3. å‰ç«¯æ ¹æ®æƒé™ä¿¡æ¯ï¼š
  //    - æ¸²æŸ“èœå•ç»“æ„
  //    - æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
  //    - è·¯ç”±æƒé™æ§åˆ¶
  //    - APIæ¥å£é‰´æƒ

  // 4. Tokenè¿‡æœŸæ—¶è‡ªåŠ¨åˆ·æ–°
  POST /system/auth/refresh-token
  â†’ è·å¾—æ–°çš„ accessToken

  ---
   æ¶æ„ä»·å€¼åˆ†æ

   ç³»ç»Ÿå…¥å£æ§åˆ¶

  - æ‰€æœ‰ç”¨æˆ·å¿…é¡»é€šè¿‡æ­¤Controllerè·å¾—ç³»ç»Ÿè®¿é—®æƒé™
  - ç»Ÿä¸€çš„è®¤è¯æ ‡å‡†å’Œå®‰å…¨ç­–ç•¥æ‰§è¡Œç‚¹

   å®‰å…¨ç­–ç•¥å®æ–½

  - é›†ä¸­çš„ä»¤ç‰Œç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸæ§åˆ¶
  - ç»Ÿä¸€çš„æƒé™ä¿¡æ¯åˆ†å‘å’Œæ ¼å¼åŒ–

   å‰ç«¯å¼€å‘æ•ˆç‡

  - ä¸€ç«™å¼æƒé™ä¿¡æ¯APIï¼Œå‰ç«¯æ— éœ€å¤šæ¬¡è¯·æ±‚
  - æ ‡å‡†åŒ–çš„æƒé™æ•°æ®æ ¼å¼ï¼Œä¾¿äºå‰ç«¯æƒé™æ§åˆ¶

  ğŸ”§ ç³»ç»Ÿæ‰©å±•æ€§

  - æ”¯æŒå¤šç§è®¤è¯æ–¹å¼æ‰©å±• (ç”¨æˆ·åå¯†ç ã€çŸ­ä¿¡ã€é‚®ç®±ç­‰)
  - çµæ´»çš„æƒé™æ¨¡å‹ï¼Œæ”¯æŒå¤æ‚çš„ä¼ä¸šçº§æƒé™éœ€æ±‚

  ---
   æ½œåœ¨å®‰å…¨é£é™©ç‚¹

   éœ€è¦å…³æ³¨çš„å®‰å…¨ç‚¹

  // 1. æ³¨å†Œæ¥å£å®‰å…¨
  register() // æ˜¯å¦éœ€è¦éªŒè¯ç é˜²åˆ·ï¼Ÿæ˜¯å¦éœ€è¦é‚®ç®±éªŒè¯ï¼Ÿ

  // 2. å¯†ç é‡ç½®å®‰å…¨
  resetPassword() // æ˜¯å¦æœ‰å……åˆ†çš„èº«ä»½éªŒè¯ï¼Ÿé˜²æš´åŠ›ç ´è§£ï¼Ÿ

  // 3. æƒé™ä¿¡æ¯æ³„éœ²
  getPermissionInfo() // è¿”å›çš„æƒé™ä¿¡æ¯æ˜¯å¦è¿‡äºè¯¦ç»†ï¼Ÿ

  // 4. ç™»å‡ºå®‰å…¨
  logout() // tokenå¤±æ•ˆæ˜¯å¦å½»åº•ï¼Ÿæ˜¯å¦æœ‰ä¼šè¯æ¸…ç†ï¼Ÿ

  ---
   æ€»ç»“

  AuthControllerï¼šç³»ç»Ÿå®‰å…¨å®ˆé—¨å‘˜

  - æ ¸å¿ƒèŒè´£ï¼šèº«ä»½è®¤è¯ã€ä»¤ç‰Œç®¡ç†ã€æƒé™åˆ†å‘
  - æŠ€æœ¯ç‰¹ç‚¹ï¼šå¤šæœåŠ¡åä½œã€RBACæƒé™æ¨¡å‹ã€å¤æ‚æ•°æ®æ•´åˆ
  - å®‰å…¨å®šä½ï¼šç³»ç»Ÿçš„ç¬¬ä¸€é“é˜²çº¿å’Œæƒé™æ§åˆ¶ä¸­æ¢
  - ä¸šåŠ¡ä»·å€¼ï¼šä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›ç»Ÿä¸€çš„è®¤è¯æˆæƒæœåŠ¡

  åœ¨ç³»ç»Ÿæ¶æ„ä¸­çš„åœ°ä½

  å‰ç«¯åº”ç”¨
      â†“ è®¤è¯æˆæƒè¯·æ±‚
   AuthController (è®¤è¯ç½‘å…³)
      â†“ å¤šæœåŠ¡åä½œ
   UserService +  RoleService +  MenuService +  PermissionService
      â†“ æƒé™æ•°æ®
   æ•°æ®åº“ (ç”¨æˆ·è¡¨ã€è§’è‰²è¡¨ã€èœå•è¡¨ã€æƒé™å…³ç³»è¡¨)

  AuthController æ˜¯æ•´ä¸ªç³»ç»Ÿå®‰å…¨æ¶æ„çš„æ ¸å¿ƒæ§åˆ¶èŠ‚ç‚¹ï¼Œæ‰¿æ‹…ç€ç”¨æˆ·èº«ä»½éªŒè¯ã€ä¼šè¯ç®¡ç†ã€æƒé™åˆ†å‘ç­‰å…³é”®èŒè´£ï¼Œæ˜¯å…¸å‹çš„ä¼ä¸šçº§å®‰å…¨åŸº
  ç¡€è®¾æ–½ç»„ä»¶ã€‚å…¶è®¾è®¡å……åˆ†ä½“ç°äº†ç°ä»£Webåº”ç”¨çš„å®‰å…¨æ¶æ„ç†å¿µå’ŒRBACæƒé™æ§åˆ¶æ¨¡å‹çš„æœ€ä½³å®è·µã€‚
