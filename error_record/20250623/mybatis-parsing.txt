q─────────────────────────────────────────────────────────────────────────────────────────────────r
│  > 你o我暮暧^角度vvmybatis的子包parsing包吧，vv它在mybatis框架中的定位角色，以及它的功能  │
t─────────────────────────────────────────────────────────────────────────────────────────────────s

? 好的，我暮暧^角度深入探一下 MyBatis 的 parsing 包。

  1. 定位c角色 (Positioning and Role)

  在 MyBatis 大的框架w系中，parsing 包扮演著 “翻g官” 和 “Y化解析器” 的核心角色。

  它本身不绦腥魏觳僮鳎也不P心事栈蜻B接池。它的唯一使命是：㈤_l者的、人可x的配置信息（主要是 XML
  文件），D化 MyBatis 炔靠梢岳斫夂吞理的、Y化的却ο蟆

  可以f，parsing 包是 MyBatis 初始化的基石。如果]有它，MyBatis 就o法x懂你的 mybatis-config.xml 和 *Mapper.xml
  文件，整框架就o法雍瓦\行。它於 MyBatis 工作流程的最前端，是B接 “oB配置” c “\行rο蟆
  的PI拧Ｋ的主要服ο笫 builder 包，builder 包使用 parsing 包提供的工具建核心的 Configuration ο蟆

  2. 主要功能 (Key Functions)

  parsing 包的功能非常Ｗ，主要@“解析”@核心展_：

   1. XML 文n解析:
       * @是它最核心的功能。它x取 mybatis-config.xml 和所有的 Mapper XML 文件。
       * 它使用实 XML 解析技g（如 DOM、SAX）KY合 XPath，能蚓实囟ㄎ坏 XML 文件中的每一c，例如 <settings>,
         <typeAliases>, <mappers>, <select>, <resultMap> 等。
       * 核心 XPathParser 封b了 XPath 功能，使得 builder 包可以像查煲臃奖愕夭樵 XML c和傩浴

   2. 孜环解析 (Placeholder Parsing):
       * MyBatis 的 SQL Z句中包含煞N孜环：#{...} 和 ${...}。
       * parsing 包提供了 GenericTokenParser @右通用的擞解析器。它可以魅腴_始擞（如 #{）和Y束擞（如
         }），然後高效地解析出中g的热荨
       * @功能於B SQL Z句中的量名提取出碇陵P重要。它⒁欢位祀s的 SQL 文本切割成oB的 SQL
         部分和B的挡糠郑獒崂m建 PreparedStatement 和到定做好洹

   3. B SQL c的初步理:
       * m然 scripting 包是最K理B SQL（如 <if>, <foreach>）的地方，但 parsing 包在解析 Mapper XML r，Re@些B
         SQL c，K⑺和普通的文本c一起，建成一初步的、包含哟谓Y的ο洹＿@ scripting
         包的後m理提供了原始的、Y化的入。

  一比喻

  如果把 MyBatis 的 Configuration ο蟊茸饕蛔建B物的完整“施工D”，那N：

   * _l者就是 “建BO”， mybatis-config.xml 和 *Mapper.xml @些“O{D”。
   * parsing 包就是一非常I的 “{DRDT”。他拿到{D後，不P心如何施工，只精_地解x{D上的每一符、每一ll
     ，然後⑦@些信息D化橐环驶的“施工指令清巍薄
   * builder 包t是 “施工指]”，它拿到@份“施工指令清巍贬幔_始{度Y源、M工人，最K建出完整的“施工D”（即
     Configuration ο螅。

  Y

  而言之，parsing 包在 MyBatis 中是一基A性、工具性的模K。它Ｂ於“解析”@一v活累活，碗s、易e的文本和 XML
  解析封b起恚樯拥 builder 包提供乾Q、易用的接口。@NP注c分x的O，使得 MyBatis
  的整w架非常清晰和可U展。

#############################################################################################################################
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────r
│  > 你在稍微vv@在parsing子包中的定位和功能幔GenericTokenParser，ParsingException,PropertyParser,TokenHandler,XN │
│    ode,XPathParser                                                                                                        │
t────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────s

? 然，很芬槟v解 parsing 包中@核心的角色和功能。

  我可以把它分成山M：XML 解析M (XPathParser, XNode) 和 孜环解析M (GenericTokenParser, TokenHandler,
  PropertyParser)，以及一 常理 (ParsingException)。

  ---

  XML 解析M

  @是 MyBatis 解析 XML 文件的基石。

  1. XPathParser
   * 定位 (Positioning): XML 文n的查引擎 (Query Engine)。
      @是c XML 文件交互的主要入口。它的作用是加d整 XML 文n，K提供一套基於 XPath 的、大而便捷的查方法，上拥
  builder 可以p地难}s的 XML Y中提取所需的信息。

   * 功能 (Function):
       * 加d XML: 造函悼梢越邮斩喾N入源，如 InputStream, Reader， XML 文n加d到却嬷行纬梢 DOM 洹
       * 量替Q: 在解析 XML 之前，它使用 PropertyParser A先理 XML 中的 ${...} 孜环，替Q成配置文件中（<properties>
         嘶`或外部 properties 文件）的H值。
       * XPath 查: 提供了一系列 eval* 方法（如 evalNode, evalString, evalBody, evalNodes），允S使用者魅 XPath
         表_式慝@取c、c列表或c的文本热荨
       * 建 `XNode`: 它的查Y果不是返回原始的、y以使用的 org.w3c.dom.Node ο螅而是⑵浒b成更友好的 XNode ο蟆

  2. XNode
   * 定位 (Positioning): 增型的 XML cο (Enhanced XML Node)。
      XNode 是 DOM Node ο蟮姆庋b和增。它屏蔽了底 DOM API 的}s性和繁操作， builder
  提供了一乾Q、、面向ο蟮慕涌碓Lc信息。你可以把它看作是 XPathParser 查Y果的矢袷健

   * 功能 (Function):
       * 化傩垣@取: 提供了 getStringAttribute(), getIntAttribute(), getBooleanAttribute()
         等一系列方法，可以安全地@取c的傩裕K能提供默J值，避免了大量的 null 判唷
       * 化热莴@取: getStringBody() 方法可以p@取c鹊奈谋热荨
       * 化子c遍v: getChildren() 方法可以方便地@取所有子c的 XNode 列表，用於fw解析。
       * 提供c路: 了母c到前c的完整路剑方便在出er打印{信息。

  f同工作: XPathParser “查”，XNode “表_查Y果”。builder 使用 XPathParser 绦幸 XPath 查，得到一或多
  XNode ο螅然後{用 XNode ο蟮母鞣N get* 方法碜x取配置信息，M而建 MyBatis 的炔ο蟆

  ---

  孜环解析M

  @MｉT理字符串中的B擞，如 #{...} 和 ${...}。

  3. GenericTokenParser
   * 定位 (Positioning): 通用的擞解析器 (Generic Token Parser)。
      @是一非常`活的工具，它的OcIoP。它的唯一是：在一o定的字符串中，找出所有由“_始擞”和“Y束擞”
  包裹的热K（token），K把它交o一理器去理。

   * 功能 (Function):
       * 接收三担洪_始擞（如 #{）、Y束擞（如 }）和一 TokenHandler 例。
       * 遍v入字符串，一旦lF一完整的 token，就 token 炔浚ú缓擞符）的热鬟fo TokenHandler 的 handleToken
         方法。
       * 用 handleToken 方法的返回值替Q掉原碜址串中的整 token（包括擞符）。

  4. TokenHandler
   * 定位 (Positioning): 擞理器接口 (Token Handler Interface)。
      @是一蔚慕涌冢只有一方法 String handleToken(String content)。它定x了一“契s”： GenericTokenParser
  找到一 token r，如何理它。

   * 功能 (Function):
       * 它的具wFQ定了 token 的理。例如，一F可以魅氲 content 作 key 去 Map 中查找
         value，另一F可以 content DQ成 JDBC 的 ? 孜环。

  5. PropertyParser
   * 定位 (Positioning): 傩孜环解析的具wF。
      PropertyParser 是使用 GenericTokenParser 和 TokenHandler 斫馕 ${...} 傩孜环的一典型用。

   * 功能 (Function):
       * 它炔F了一私有的 TokenHandler。@ handler 的是：接收到 token 热荩ㄈ db.username），就去一
         Properties ο笾胁檎的值。
       * 它ν馓峁┮oB方法 parse(String string, Properties variables)，用於⒁包含 ${...} 的字符串，Y合o定的
         Properties，解析成最K的字符串。

  f同工作: GenericTokenParser 是引擎，TokenHandler 是引擎要绦械木唧w指令。PropertyParser
  t是⑦@烧呓M合起恚ｉT用於理 ${...} 傩蕴Q的便捷工具。XPathParser 在解析 XML r，就使用 PropertyParser
  硗瓿勺量替Q。

  ---

  常理

  6. ParsingException
   * 定位 (Positioning): 解析^程的Ｓ卯常信。
      @是一自定x的 RuntimeException，ｉT用於在解析 XML 或 token 的^程中l生e`r出。

   * 功能 (Function):
       * y一常型: ⑺有在解析A段可能l生的底赢常（如 IOException, SAXException, XPathExpressionException 等）包b成
         ParsingException。
       * 提供上下文信息: 它的造函低ǔ接收e`信息和原始常，有r附加上出e的 XNode
         的路剑使得e`日I更清晰，能快速定位到是哪配置文件的哪一行出了}。

  ---

  Y

   *  MyBatis r，XMLConfigBuilder 建一 XPathParser 碜x取 mybatis-config.xml。
   * XPathParser 在x取r，先用 PropertyParser 把 XML 中的 ${...} 替Q掉。
   * builder 通^ XPathParser 的 evalNode("/configuration/mappers") 等方法@取到一 XNode。
   * builder 再{用 xnode.getChildren() 遍v <mapper> c，KγcM行fw解析。
   * 在解析 <select> 嘶`鹊 SQL Z句r，XMLScriptBuilder 用到 GenericTokenParser 硖理 #{...} 孜环。
   * 如果在任何一步出e（比如 XPath e、傩悦不存在），就出一 ParsingException，K止舆^程。

#############################################################################################################################



#############################################################################################################################




#############################################################################################################################



#############################################################################################################################



#############################################################################################################################



#############################################################################################################################


#############################################################################################################################



#############################################################################################################################



#############################################################################################################################


#############################################################################################################################


#############################################################################################################################
