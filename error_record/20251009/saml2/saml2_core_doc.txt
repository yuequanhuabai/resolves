 SAML2 核心架

  三方角色

  用g[器 <---> SP (後端 Spring Boot) <---> IdP (Keycloak)

  JC流程（5步）

  1. 用酎c舻卿 → 前端跳D /saml2/authenticate/keycloak
  2. SP 生成 AuthnRequest → 重定向到 Keycloak
  3. 用粼 Keycloak 入っ
  4. Keycloak 生成 SAMLResponse → POST 回 SP 的 ACS URL
  5. SP C名、解析用粜畔 → 建 Session → 跳D Dashboard

  核心配置
  ┌─────────────────────┬────────────────────────────────────────────┐
  │       配置        │                    作用                    │
  ├─────────────────────┼────────────────────────────────────────────┤
  │ entity-id           │ SP 的唯一俗R，Keycloak Client ID 必匹配 │
  ├─────────────────────┼────────────────────────────────────────────┤
  │ signing.credentials │ SP 名求用的私/C                   │
  ├─────────────────────┼────────────────────────────────────────────┤
  │ metadata-uri        │ IdP 的公、端c信息（用於C）       │
  └─────────────────────┴────────────────────────────────────────────┘
  PI端c
  ┌──────────────────────────────┬────────────────────────────┐
  │             端c             │            用途            │
  ├──────────────────────────────┼────────────────────────────┤
  │ /saml2/authenticate/keycloak │ l起JC求               │
  ├──────────────────────────────┼────────────────────────────┤
  │ /login/saml2/sso/keycloak    │ 接收 IdP  (ACS)        │
  ├──────────────────────────────┼────────────────────────────┤
  │ /saml2/metadata/keycloak     │ SP 元（o IdP 入用） │
  └──────────────────────────────┴────────────────────────────┘
  信任PS

  SP 信任 IdP：通^ keycloak-saml-metadata.xml 中的公C名
  IdP 信任 SP：通^入的 saml-signing.crt C求名

  ==================================================================================================


    SAML2 安全机制的核心目的
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │                          SAML2 安全层次                                      │
    ├─────────────────────────────────────────────────────────────────────────────┤
    │                                                                             │
    │   第一层：安全保障（最重要）                                                  │
    │   ┌─────────────────────────────────────────────────────────────────────┐  │
    │   │  ? 数字签名 (Signature)     → 防篡改 + 验证来源                      │  │
    │   │  ? 证书 (Certificate)       → 建立信任关系                          │  │
    │   │  ? 私钥 (Private Key)       → 生成签名                              │  │
    │   │  ? 时间戳 (IssueInstant)    → 防重放攻击                            │  │
    │   │  ? ID (唯一标识)            → 防重放攻击                            │  │
    │   └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                             │
    │   第二层：业务参数                                                           │
    │   ┌─────────────────────────────────────────────────────────────────────┐  │
    │   │  ? Issuer                   → 谁发的请求                            │  │
    │   │  ? NameID                   → 用户标识                              │  │
    │   │  ? Destination              → 发给谁                                │  │
    │   │  ? AssertionConsumerURL     → 回调地址                              │  │
    │   └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                             │