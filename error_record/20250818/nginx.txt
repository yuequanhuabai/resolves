ğŸ”¹ Nginx å¸¸ç”¨å†…ç½®å˜é‡å¯¹ç…§è¡¨
1. å®¢æˆ·ç«¯ç›¸å…³
å˜é‡	å«ä¹‰	ç¤ºä¾‹
$remote_addr	å®¢æˆ·ç«¯ IP åœ°å€ï¼ˆç›´è¿åˆ° Nginx çš„ IPï¼‰	192.168.1.10
$remote_port	å®¢æˆ·ç«¯ç«¯å£å·	53210
$http_x_forwarded_for	è¯·æ±‚å¤´é‡Œçš„ X-Forwarded-Forï¼ˆå¯èƒ½æœ‰å¤šä¸ª IPï¼‰	203.0.113.1, 10.0.0.1
$proxy_add_x_forwarded_for	$http_x_forwarded_for + $remote_addrï¼ˆè‡ªåŠ¨è¿½åŠ å½“å‰ IPï¼‰	203.0.113.1, 10.0.0.1, 192.168.1.10
$http_user_agent	å®¢æˆ·ç«¯æµè§ˆå™¨æ ‡è¯†	Mozilla/5.0 ... Chrome/116.0
$http_referer	æ¥æºé¡µé¢ URL	https://google.com/
2. è¯·æ±‚ç›¸å…³
å˜é‡	å«ä¹‰	ç¤ºä¾‹
$request	åŸå§‹è¯·æ±‚è¡Œ	GET /index.html HTTP/1.1
$request_uri	è¯·æ±‚çš„å®Œæ•´ URIï¼ˆåŒ…å«å‚æ•°ï¼‰	/index.html?foo=bar
$uri	è¯·æ±‚è·¯å¾„ï¼ˆå»æ‰å‚æ•°ï¼Œå¯èƒ½è¢« rewrite ä¿®æ”¹è¿‡ï¼‰	/index.html
$args	è¯·æ±‚å‚æ•°ï¼ˆquery stringï¼‰	foo=bar&x=1
$scheme	è¯·æ±‚åè®®	http æˆ– https
$request_method	è¯·æ±‚æ–¹æ³•	GET / POST / PUT / DELETE
$is_args	å¦‚æœæœ‰å‚æ•°åˆ™ä¸º ?ï¼Œå¦åˆ™ä¸ºç©º	?
$query_string	åŒ $args	foo=bar&x=1
3. æœåŠ¡å™¨ç›¸å…³
å˜é‡	å«ä¹‰	ç¤ºä¾‹
$host	è¯·æ±‚çš„ Hostï¼ˆå¯èƒ½æ¥è‡ª Host è¯·æ±‚å¤´ï¼Œæˆ– server_nameï¼‰	example.com
$http_host	è¯·æ±‚å¤´ä¸­çš„ Hostï¼ˆä¼˜å…ˆäº $hostï¼‰	example.com:8080
$server_addr	Nginx æœåŠ¡å™¨æœ¬æœº IP	10.0.0.5
$server_port	Nginx ç›‘å¬çš„ç«¯å£	80
$server_name	å‘½ä¸­çš„ server_name é…ç½®å€¼	example.com
4. ä»£ç† & ä¸Šæ¸¸ç›¸å…³
å˜é‡	å«ä¹‰	ç¤ºä¾‹
$upstream_addr	ä¸Šæ¸¸æœåŠ¡å™¨åœ°å€	127.0.0.1:8080
$upstream_response_time	ä¸Šæ¸¸å“åº”æ—¶é—´	0.045
$upstream_status	ä¸Šæ¸¸è¿”å›çš„çŠ¶æ€ç 	200
$proxy_host	proxy_pass é‡Œçš„ä¸»æœºå	backend.local
$proxy_port	proxy_pass çš„ç«¯å£	8080
5. å…¶ä»–å¸¸ç”¨
å˜é‡	å«ä¹‰	ç¤ºä¾‹
$status	è¿”å›ç»™å®¢æˆ·ç«¯çš„ HTTP çŠ¶æ€ç 	200
$body_bytes_sent	å·²å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ä½“å¤§å°ï¼ˆå­—èŠ‚ï¼‰	15432
$time_local	æœ¬åœ°æ—¶é—´	28/Aug/2025:14:32:11 +0800
$msec	å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰	1693216331.123
$request_time	å¤„ç†è¯·æ±‚è€—æ—¶ï¼ˆç§’ï¼‰	0.123

âœ… æ€»ç»“

$http_xxx ç³»åˆ—ï¼šå–è¯·æ±‚å¤´å­—æ®µï¼Œä¾‹å¦‚ $http_user_agentã€$http_cookieã€‚

$proxy_add_x_forwarded_for å¸¸ç”¨åœ¨åå‘ä»£ç†ï¼Œç¡®ä¿èƒ½æ‹¿åˆ°ç”¨æˆ·çœŸå® IPã€‚

$request_uri vs $uriï¼šå‰è€…å¸¦å‚æ•°ï¼Œåè€…ä¸å¸¦å‚æ•°ã€‚

$host vs $http_hostï¼šå¤§éƒ¨åˆ†åœºæ™¯å·®ä¸å¤šï¼Œä½† $http_host ç›´æ¥å–è¯·æ±‚å¤´ï¼Œæ›´ç²¾ç¡®ã€‚