 审查完了，发现不少问题。按严重程度分类如下：

  ---
  HIGH — 必须修复（8 个）
  ┌─────────────────────┬──────────┬───────────────────────────────────────────────────────────────────────────────────┬──────────────────────┐
  │        方法         │   行号   │                                       问题                                        │         风险         │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ updateProcessStatus │ 114-115  │ selectById 返回 null 后直接使用，无空判断                                         │ NPE 崩溃             │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ updateProcessStatus │ 112      │ 缺少 @Transactional，多次写库无事务保护                                           │ 部分更新，数据不一致 │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ updateList          │ 218-236  │ originalList 有 null 判断但没作为拦截条件                                         │ NPE                  │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ updateNewList       │ 269-274  │ originalList 完全没有 null 判断                                                   │ NPE 崩溃             │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ updateNewList       │ 274      │ validateRecordVersion 返回值被忽略，乐观锁形同虚设                                │ 并发覆盖，数据丢失   │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ listMap + checkData │ 651, 672 │ listMap() 可能返回 null，checkData 用 assert 做空判断（生产环境 assert 默认关闭） │ NPE 崩溃             │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ checkData           │ 673-674  │ stringStringMap.get() 返回 null，拼出无效表名                                     │ 查询错误             │
  ├─────────────────────┼──────────┼───────────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
  │ sendNotification    │ 747      │ 通知失败会回滚整个业务事务（包括建单、启流程等所有操作）                          │ 业务数据全部丢失     │
  └─────────────────────┴──────────┴───────────────────────────────────────────────────────────────────────────────────┴──────────────────────┘
  MEDIUM — 建议修复（12 个）
  ┌─────────────────────────────────────┬─────────┬───────────────────────────────────────────────────┐
  │                方法                 │  行号   │                       问题                        │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ getProcessKey                       │ 198     │ BPM 服务调用无异常处理                            │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ validateRecordVersion               │ 566     │ reqVO.getRecordVersion() 为 null 时自动拆箱 NPE   │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ updateList                          │ 221     │ .last("TOP 1") 是 SQL Server 专属语法，换库会报错 │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ updateList                          │ 230     │ checkDataInRedis 内部逻辑被注释，疑似死代码       │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ insertBuyListDetail                 │ 358-381 │ clientIds 为空时可能执行空批量插入                │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ insertNewBuyListByOriginalBizStatus │ 430     │ bizStatus 为 null 时所有分支都不进入，静默跳过    │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ insertNewBuyListByOriginalBizStatus │ 449/493 │ null recordVersion 自动拆箱 NPE                   │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ listMap                             │ 653-655 │ Collectors.toMap 遇到重复 key 会抛异常            │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ checkData                           │ 694-705 │ O(N*M) 重复调用外部服务，性能隐患                 │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ startProcess                        │ 733-736 │ 错误状态更新会被事务回滚，实际无效                │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ parseAndValidateFile                │ 754     │ 无文件大小限制，可能 OOM                          │
  ├─────────────────────────────────────┼─────────┼───────────────────────────────────────────────────┤
  │ getClientIdSet                      │ 1153    │ getAssetTypeNewDataMap 返回 null 时 NPE           │
  └─────────────────────────────────────┴─────────┴───────────────────────────────────────────────────┘
  LOW — 可优化（10+ 个）
  ┌─────────────────────────┬──────┬────────────────────────────────────────────┐
  │          方法           │ 行号 │                    问题                    │
  ├─────────────────────────┼──────┼────────────────────────────────────────────┤
  │ insetBuyListSL          │ 1118 │ 方法名拼写错误，应为 insertBuyListSL       │
  ├─────────────────────────┼──────┼────────────────────────────────────────────┤
  │ insetBuyListSL          │ 1120 │ 入参无 null/空校验                         │
  ├─────────────────────────┼──────┼────────────────────────────────────────────┤
  │ getBuyListAssetTypes    │ 1131 │ mapper 返回 null 时 .stream() NPE          │
  ├─────────────────────────┼──────┼────────────────────────────────────────────┤
  │ getClientIdSet          │ 1145 │ selectListByType 返回 null 时 for-each NPE │
  ├─────────────────────────┼──────┼────────────────────────────────────────────┤
  │ parseCsvFile            │ 892  │ 不支持包含逗号/引号的 CSV 字段             │
  ├─────────────────────────┼──────┼────────────────────────────────────────────┤
  │ getProcessKey           │ 205  │ 直接返回 null 给调用方                     │
  ├─────────────────────────┼──────┼────────────────────────────────────────────┤
  │ preCheckMakerSubmitData │ 337  │ 用 null 表示"无错误"，语义不清             │
  └─────────────────────────┴──────┴────────────────────────────────────────────┘
  ---
  最需要优先修的 5 个

  1. updateNewList 忽略 validateRecordVersion 返回值 — 乐观锁失效，并发时数据会被覆盖
  2. checkData 中用 assert 做空判断 — 生产环境不生效，直接 NPE
  3. updateProcessStatus 缺少 @Transactional — 多步写库无事务，失败后数据不一致
  4. sendNotification 失败回滚业务事务 — 发通知失败不应导致建单失败
  5. 多处 selectById 返回 null 无判断 — NPE 风险
