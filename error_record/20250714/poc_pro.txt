æˆ‘ä¾†å¹«æ‚¨æ·±å…¥äº†è§£è©²é …ç›®çš„æµç¨‹éƒ¨åˆ†å’Œä»»å‹™éƒ¨åˆ†ã€‚è®“æˆ‘å…ˆæŸ¥çœ‹ç›¸é—œçš„æ¨¡å¡Šå’Œä»£ç¢¼çµæ§‹ã€‚

Ran tool
Search files...
Search files...
Read file: pap-server/src/main/java/cn/iocoder/yudao/server/bpm/service/task/BpmTaskServiceImpl.java
Search files...
åŸºæ–¼æˆ‘å°è©²é …ç›®æµç¨‹éƒ¨åˆ†å’Œä»»å‹™éƒ¨åˆ†çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä¾†ç‚ºæ‚¨è©³ç´°ä»‹ç´¹é€™å…©å€‹æ ¸å¿ƒåŠŸèƒ½ï¼š

## ğŸ”„ æµç¨‹éƒ¨åˆ† (Process)

### 1. æµç¨‹æ¶æ§‹å±¤æ¬¡

```
æµç¨‹æ¨¡å‹ (Model) â†’ æµç¨‹å®šç¾© (ProcessDefinition) â†’ æµç¨‹å¯¦ä¾‹ (ProcessInstance) â†’ ä»»å‹™ (Task)
```

### 2. æ ¸å¿ƒçµ„ä»¶

#### **æµç¨‹æ¨¡å‹ (BpmModel)**
- **è¨­è¨ˆå™¨é¡å‹**: æ”¯æŒæ¨™æº– BPMN è¨­è¨ˆå™¨å’Œä»¿é‡˜é‡˜çš„ Simple è¨­è¨ˆå™¨
- **ç¯€é»é¡å‹**:
  - `START_NODE(0)` - é–‹å§‹ç¯€é»
  - `APPROVE_NODE(11)` - å¯©æ‰¹äººç¯€é»
  - `COPY_NODE(12)` - æŠ„é€äººç¯€é»
  - `TRANSACTOR_NODE(13)` - è¾¦ç†äººç¯€é»
  - `DELAY_TIMER_NODE(14)` - å»¶é²å™¨ç¯€é»
  - `TRIGGER_NODE(15)` - è§¸ç™¼å™¨ç¯€é»
  - `CHILD_PROCESS(20)` - å­æµç¨‹ç¯€é»

#### **æµç¨‹å®šç¾© (ProcessDefinition)**
```java
// æ ¸å¿ƒè¡¨çµæ§‹
bpm_process_definition_info {
    process_definition_id,  // æµç¨‹å®šç¾©ID
    model_id,              // æµç¨‹æ¨¡å‹ID
    model_type,            // æ¨¡å‹é¡å‹
    category,              // æµç¨‹åˆ†é¡
    form_type,             // è¡¨å–®é¡å‹
    form_id,              // è¡¨å–®ID
    simple_model,         // Simpleè¨­è¨ˆå™¨æ¨¡å‹æ•¸æ“š
    start_user_ids,       // å¯ç™¼èµ·ç”¨æˆ¶
    manager_user_ids,     // å¯ç®¡ç†ç”¨æˆ¶
    auto_approval_type,   // è‡ªå‹•å¯©æ‰¹é¡å‹
    // ... å…¶ä»–é…ç½®
}
```

#### **æµç¨‹å¯¦ä¾‹ (ProcessInstance)**
- **ç‹€æ…‹ç®¡ç†**: `NOT_START(-1)`, `RUNNING(1)`, `APPROVE(2)`, `REJECT(3)`, `CANCEL(4)`
- **è®Šé‡ç®¡ç†**: æ”¯æŒæµç¨‹è®Šé‡ã€æ¥­å‹™è®Šé‡
- **è§¸ç™¼å™¨**: æ”¯æŒæµç¨‹å‰å¾Œç½®è§¸ç™¼å™¨ã€ä»»å‹™å‰å¾Œç½®è§¸ç™¼å™¨

### 3. æµç¨‹è¨­è¨ˆå™¨åŠŸèƒ½

#### **Simple è¨­è¨ˆå™¨ (ä»¿é‡˜é‡˜)**
```java
// ç¯€é»é¡å‹æšèˆ‰
BpmSimpleModelNodeTypeEnum {
    START_NODE(0, "é–‹å§‹"),
    APPROVE_NODE(11, "å¯©æ‰¹äºº"),
    COPY_NODE(12, "æŠ„é€äºº"),
    CONDITION_BRANCH_NODE(51, "æ¢ä»¶åˆ†æ”¯"),
    PARALLEL_BRANCH_NODE(52, "ä¸¦è¡Œåˆ†æ”¯"),
    // ...
}
```

#### **BPMN æ¨™æº–è¨­è¨ˆå™¨**
- æ”¯æŒå®Œæ•´çš„ BPMN 2.0 æ¨™æº–
- è‡ªå‹•ä½ˆå±€åŠŸèƒ½
- XML Schema é©—è­‰

## ï¿½ï¿½ ä»»å‹™éƒ¨åˆ† (Task)

### 1. ä»»å‹™ç‹€æ…‹ç®¡ç†

```java
BpmTaskStatusEnum {
    NOT_START(-1, "æœªé–‹å§‹"),
    RUNNING(1, "å¯©æ‰¹ä¸­"),
    APPROVE(2, "å¯©æ‰¹é€šé"),
    REJECT(3, "å¯©æ‰¹ä¸é€šé"),
    CANCEL(4, "å·²å–æ¶ˆ"),
    RETURN(5, "å·²é€€å›"),
    APPROVING(7, "å¯©æ‰¹é€šéä¸­"),  // åŠ ç°½å ´æ™¯
    WAIT(0, "å¾…å¯©æ‰¹")           // åŠ ç°½ç­‰å¾…
}
```

### 2. ä»»å‹™æ“ä½œåŠŸèƒ½

#### **åŸºç¤å¯©æ‰¹æ“ä½œ**
```java
// å¯©æ‰¹é€šé
void approveTask(Long userId, BpmTaskApproveReqVO reqVO);

// å¯©æ‰¹æ‹’çµ•
void rejectTask(Long userId, BpmTaskRejectReqVO reqVO);

// ä»»å‹™é€€å›
void returnTask(Long userId, BpmTaskReturnReqVO reqVO);
```

#### **é«˜ç´šä»»å‹™æ“ä½œ**
```java
// ä»»å‹™å§”æ´¾
void delegateTask(Long userId, BpmTaskDelegateReqVO reqVO);

// ä»»å‹™è½‰è¾¦
void transferTask(Long userId, BpmTaskTransferReqVO reqVO);

// ä»»å‹™åŠ ç°½
void createSignTask(Long userId, BpmTaskSignCreateReqVO reqVO);

// ä»»å‹™æ¸›ç°½
void deleteSignTask(Long userId, BpmTaskSignDeleteReqVO reqVO);

// ä»»å‹™æŠ„é€
void copyTask(Long userId, BpmTaskCopyReqVO reqVO);
```

### 3. ä»»å‹™äº‹ä»¶è™•ç†

#### **ä»»å‹™ç”Ÿå‘½é€±æœŸäº‹ä»¶**
```java
// ä»»å‹™å‰µå»ºäº‹ä»¶
void processTaskCreated(Task task);

// ä»»å‹™åˆ†é…äº‹ä»¶
void processTaskAssigned(Task task);

// ä»»å‹™å®Œæˆäº‹ä»¶
void processTaskCompleted(Task task);

// ä»»å‹™å–æ¶ˆäº‹ä»¶
void processTaskCanceled(String taskId);

// ä»»å‹™è¶…æ™‚äº‹ä»¶
void processTaskTimeout(String processInstanceId, String taskDefineKey, Integer handlerType);
```

### 4. ä»»å‹™å€™é¸äººç­–ç•¥

```java
BpmTaskCandidateStrategyEnum {
    USER,           // æŒ‡å®šç”¨æˆ¶
    ROLE,           // æŒ‡å®šè§’è‰²
    DEPT,           // æŒ‡å®šéƒ¨é–€
    POST,           // æŒ‡å®šå´—ä½
    SCRIPT,         // è…³æœ¬è¡¨é”å¼
    // ...
}
```

### 5. ä»»å‹™è¶…æ™‚è™•ç†

```java
BpmUserTaskTimeoutHandlerTypeEnum {
    NOTIFY(1, "é€šçŸ¥"),      // åƒ…ç™¼é€é€šçŸ¥
    APPROVE(2, "åŒæ„"),     // è‡ªå‹•åŒæ„
    REJECT(3, "æ‹’çµ•")       // è‡ªå‹•æ‹’çµ•
}
```

## ï¿½ï¿½ æ ¸å¿ƒç‰¹æ€§

### 1. **å¤šç§Ÿæˆ¶æ”¯æŒ**
- å®Œæ•´çš„ SaaS å¤šç§Ÿæˆ¶æ¶æ§‹
- ç§Ÿæˆ¶éš”é›¢çš„æµç¨‹å’Œä»»å‹™ç®¡ç†

### 2. **æ¬Šé™æ§åˆ¶**
- æµç¨‹ç™¼èµ·æ¬Šé™æ§åˆ¶
- ä»»å‹™è™•ç†æ¬Šé™æ§åˆ¶
- æ•¸æ“šæ¬Šé™æ§åˆ¶

### 3. **è¡¨å–®é›†æˆ**
- å‹•æ…‹è¡¨å–®æ”¯æŒ
- è‡ªå®šç¾©è¡¨å–®è·¯å¾‘
- è¡¨å–®æ•¸æ“šé©—è­‰

### 4. **æ¶ˆæ¯é€šçŸ¥**
- ä»»å‹™åˆ†é…é€šçŸ¥
- å¯©æ‰¹çµæœé€šçŸ¥
- è¶…æ™‚æé†’é€šçŸ¥

### 5. **å¯©è¨ˆæ—¥èªŒ**
- å®Œæ•´çš„æ“ä½œæ—¥èªŒ
- æµç¨‹è®Šæ›´è¨˜éŒ„
- ä»»å‹™è™•ç†è¨˜éŒ„

é€™å€‹å·¥ä½œæµå¼•æ“åŸºæ–¼ **Flowable** æ¡†æ¶ï¼Œæä¾›äº†ä¼æ¥­ç´šçš„æµç¨‹ç®¡ç†å’Œä»»å‹™è™•ç†èƒ½åŠ›ï¼Œæ”¯æŒè¤‡é›œçš„æ¥­å‹™å ´æ™¯å’Œéˆæ´»çš„é…ç½®é¸é …ã€‚